"use strict";(self.webpackChunk_krassowski_jupyterlab_lsp=self.webpackChunk_krassowski_jupyterlab_lsp||[]).push([[321],{4988:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".lsp-floating-console {\n  position: absolute;\n  width: 600px;\n  min-height: 350px;\n  height: 25%;\n  right: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 3px solid rgba(204, 204, 204, 0.7);\n  font-size: 12px;\n  overflow-y: auto;\n  margin: 0;\n  list-style-type: none;\n  padding: 5px;\n  z-index: 100;\n}\n\n.lsp-code {\n  font-family: monospace;\n  background: #eee;\n  border-radius: 2px;\n  padding: 2px 5px;\n}\n\n.lsp-kind {\n  padding: 2px 5px;\n}\n",""]);const o=s},2372:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".lsp-diagnostics-panel-content {\n  overflow-y: auto;\n}\n\n.lsp-diagnostics-listing {\n  color: var(--jp-ui-font-color1);\n  background: var(--jp-layout-color1);\n  font-size: var(--jp-ui-font-size1);\n  border-spacing: 0;\n  /* required to preserve borders of `<th>` when using position:sticky */\n  border-collapse: separate;\n  width: 100%;\n}\n\n.lsp-diagnostics-listing thead {\n  box-shadow: var(--jp-toolbar-box-shadow);\n}\n\n.lsp-diagnostics-listing tbody {\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.lsp-diagnostics-listing th,\n.lsp-diagnostics-listing td {\n  padding: 4px 12px 2px 12px;\n  height: 18px;\n}\n\n.lsp-diagnostics-listing th {\n  font-weight: 500;\n  text-align: left;\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.lsp-diagnostics-listing th:not(:first-child) {\n  border-left: var(--jp-border-width) solid var(--jp-border-color2);\n}\n\n.lsp-diagnostics-listing th:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing tbody tr:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing thead th > div {\n  flex-direction: row;\n  display: flex;\n}\n\n.lsp-diagnostics-listing thead th > div > label {\n  flex: 1;\n  text-overflow: ellipsis;\n}\n\n.lsp-sort-icon {\n  flex: 0;\n  height: var(--jp-ui-font-size1);\n  width: var(--jp-ui-font-size1);\n}\n\n.lsp-sort-icon svg {\n  display: inline;\n  height: auto;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header) .lsp-sort-icon {\n  opacity: 0;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header):hover .lsp-sort-icon {\n  opacity: 0.5;\n}\n",""]);const o=s},3075:(e,t,n)=>{n.d(t,{Z:()=>d});var i=n(2609),s=n.n(i),o=n(8996),r=n(6801),a=n(2361),l=n(6143),c=s()((function(e){return e[1]}));c.i(o.Z),c.i(r.Z),c.i(a.Z),c.i(l.Z),c.push([e.id,'.cm-lsp-diagnostic {\n  text-decoration-line: underline;\n  /* For Chrome */\n  text-decoration-skip-ink: none;\n}\n\n.cm-lsp-diagnostic-tag-Unnecessary {\n  /*\n   * LSP: "Clients are allowed to render diagnostics with this tag faded out instead of having an error squiggle."\n   */\n  filter: grayscale(1);\n  opacity: 0.7;\n  text-decoration: none !important;\n}\n\n.cm-lsp-diagnostic-tag-Deprecated {\n  /*\n   * LSP: "Clients are allowed to rendered diagnostics with this tag strike through."\n   */\n  text-decoration: line-through !important;\n}\n\n.cm-lsp-diagnostic-Error {\n  /*\n    "wavy" would be ideal, but there seems to be a bug in Chrome which makes it\n    fail to render the last character see:\n    https://stackoverflow.com/questions/57559588/how-to-make-the-wavy-underline-extend-cover-all-the-characters-in-chrome\n    an alternative would be to use background image trick to simulate the underline\n  */\n\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-error-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Warning {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-warning-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Information {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-information-decoration-color\n  );\n}\n\n.cm-lsp-diagnostic-Hint {\n  text-decoration-style: var(\n    --jp-editor-mirror-lsp-diagnostic-decoration-style\n  );\n  text-decoration-color: var(\n    --jp-editor-mirror-lsp-diagnostic-hint-decoration-color\n  );\n}\n\n/* hover */\n.cm-lsp-hover-available {\n  text-decoration: var(--jp-editor-mirror-lsp-hover-decoration-style);\n  text-decoration-color: var(--jp-editor-mirror-lsp-hover-decoration-color);\n  text-decoration-line: underline;\n  text-decoration-skip-ink: none;\n}\n\n/* highlight */\n.cm-lsp-highlight {\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n}\n',""]);const d=c},4599:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(2609),s=n.n(i),o=n(3075),r=n(9538),a=n(4302),l=s()((function(e){return e[1]}));l.i(o.Z),l.i(r.Z),l.i(a.Z),l.push([e.id,".lsp-document-locator:hover {\n  cursor: pointer;\n}\n\n.lsp-document-locator span:not(:last-child)::after {\n  content: ' > ';\n}\n\n.lsp-icon-flip-x {\n  transform: scaleX(-1);\n  transform-origin: center center;\n}\n\n.lsp-external-link {\n  color: var(--jp-content-link-color);\n}\n",""]);const c=l},4302:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".lsp-signature-help pre code {\n  font-size: var(--jp-code-font-size);\n}\n",""]);const o=s},4929:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".lsp-popover {\n  /* jupyterlab Menu */\n  z-index: 10000;\n  padding: 4px 0px;\n  background: var(--jp-layout-color0);\n  color: var(--jp-ui-font-color1);\n  border: var(--jp-border-width) solid var(--jp-border-color1);\n  font-size: var(--jp-ui-font-size1);\n  box-shadow: var(--jp-elevation-z6);\n}\n\n.lsp-popover-content {\n  padding: 5px 10px;\n}\n\n.lsp-servers-title {\n  margin-bottom: 5px;\n}\n\n.lsp-servers-menu {\n  height: 350px;\n  overflow-y: auto;\n}\n\n.lsp-server-status,\n.lsp-missing-server,\n.lsp-documents-by-language {\n  margin-left: 20px;\n}\n\nh5 .lsp-language-server-name {\n  color: var(--jp-ui-font-color2);\n}\n\n.lsp-documents-by-language ul,\n.lsp-server-status ul {\n  margin: 0;\n  padding-left: 25px;\n}\n\n.lsp-servers-menu h5 {\n  font-weight: normal;\n  font-size: 100%;\n  white-space: nowrap;\n}\n\n.lsp-servers-lists {\n  margin-left: 5px;\n}\n\n.lsp-popover-status {\n  padding-top: 5px;\n  border-top: 1px solid var(--jp-border-color1);\n}\n\n.lsp-popover-status a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-servers-menu h3,\nh4,\nh5 {\n  margin: 0;\n}\n\n.lsp-documents-by-language li {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n}\n\n.lsp-document-status {\n  float: right;\n  padding-left: 15px;\n}\n\n.lsp-document-status-icon {\n  margin-left: 5px;\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list h4 {\n  cursor: pointer;\n}\n\n.lsp-collapsible-list .lsp-caret-icon {\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list.lsp-collapsed div {\n  display: none;\n}\n\n.lsp-statusbar-item {\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color0);\n}\n\n.lsp-status-icon.preparing svg g {\n  fill: var(--jp-warn-color0);\n}\n\n.lsp-status-icon.error svg g {\n  fill: var(--jp-error-color0);\n}\n\n.lsp-status-icon.inactive svg g {\n  fill: var(--jp-layout-color3);\n}\n\n.lsp-status-message {\n  user-select: none;\n}\n\nbody[data-jp-theme-light='false'] .lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color1);\n}\n\n.lsp-statusbar-item.jp-mod-selected .jp-icon-selectable[fill] {\n  fill: #fff;\n}\n\n.jp-ToolbarButton .lsp-status-icon svg {\n  top: 5px;\n}\n\n.lsp-help-button {\n  background: var(--jp-layout-color2);\n  border: 1px solid var(--jp-brand-color0);\n  float: right;\n}\n\n.lsp-help-button:hover {\n  background: var(--jp-layout-color3);\n}\n\n.lsp-server-links-list a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-troubleshoot-section {\n  white-space: pre-wrap;\n  margin: 10px 0;\n}\n",""]);const o=s},9538:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".lsp-tooltip .jp-RenderedHTMLCommon {\n  /* Reduce the default padding from 20px to 0px */\n  padding-right: 0px;\n}\n\n.lsp-tooltip .jp-RenderedHTMLCommon > *:last-child {\n  /* Reduce the default margin */\n  margin-bottom: 0;\n}\n",""]);const o=s},8996:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,":root {\n  /* highlight */\n  --jp-editor-mirror-lsp-highlight-background-color: var(--jp-layout-color2);\n  /* diagnostics */\n  --jp-editor-mirror-lsp-diagnostic-decoration-style: dashed;\n  --jp-editor-mirror-lsp-diagnostic-error-decoration-color: var(\n    --jp-error-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-warning-decoration-color: var(\n    --jp-warn-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-information-decoration-color: var(\n    --jp-info-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-hint-decoration-color: var(\n    --jp-success-color1\n  );\n  /* hover */\n  --jp-editor-mirror-lsp-hover-decoration-style: dotted;\n  --jp-editor-mirror-lsp-hover-decoration-color: var(--jp-brand-color1);\n}\n",""]);const o=s},6801:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".cm-s-abcdef {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(144, 199, 255, 0.2);\n}\n\n.cm-s-base16-dark {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-base16-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(186, 192, 161, 0.1);\n}\n\n.cm-s-default {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-hopscotch {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(207, 18, 255, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 255, 58, 0.2);\n}\n\n.cm-s-mbo {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-mdn-like {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-seti {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-solarized {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-the-matrix {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.1);\n}\n\n.cm-s-xq-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-zenburn {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n",""]);const o=s},2361:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,"body[data-jp-theme-light='false'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(151, 173, 255, 0.3);\n}\n",""]);const o=s},6143:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(2609),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,"body[data-jp-theme-light='true'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n",""]);const o=s},5384:(e,t,n)=>{n.d(t,{wo:()=>s,Uu:()=>r,OC:()=>a,kZ:()=>l});var i=n(1797);const s="lsp-completer-theme-";var o;!function(e){e[e.Text=1]="Text",e[e.Method=2]="Method",e[e.Function=3]="Function",e[e.Constructor=4]="Constructor",e[e.Field=5]="Field",e[e.Variable=6]="Variable",e[e.Class=7]="Class",e[e.Interface=8]="Interface",e[e.Module=9]="Module",e[e.Property=10]="Property",e[e.Unit=11]="Unit",e[e.Value=12]="Value",e[e.Enum=13]="Enum",e[e.Keyword=14]="Keyword",e[e.Snippet=15]="Snippet",e[e.Color=16]="Color",e[e.File=17]="File",e[e.Reference=18]="Reference",e[e.Folder=19]="Folder",e[e.EnumMember=20]="EnumMember",e[e.Constant=21]="Constant",e[e.Struct=22]="Struct",e[e.Event=23]="Event",e[e.Operator=24]="Operator",e[e.TypeParameter=25]="TypeParameter"}(o||(o={}));const r="@krassowski/completion-manager",a="Kernel",l=new i.Token(r+":ILSPCompletionThemeManager")},1321:(e,t,n)=>{n.r(t),n.d(t,{FeatureManager:()=>ti,ILSPAdapterManager:()=>a,ILSPCodeExtractorsManager:()=>c,ILSPCodeOverridesManager:()=>f,ILSPFeatureManager:()=>r,ILSPLogConsole:()=>d,ILSPVirtualEditorManager:()=>l,ILanguageServerManager:()=>i,LSPExtension:()=>ni,PLUGIN_ID:()=>o,RegExpForeignCodeExtractor:()=>m,default:()=>oi});var i,s=n(1797);!function(e){e.URL_NS="lsp"}(i||(i={}));const o="@krassowski/jupyterlab-lsp",r=new s.Token(o+":ILSPFeatureManager"),a=new s.Token(o+":ILSPAdapterManager"),l=new s.Token(o+":ILSPVirtualEditorManager"),c=new s.Token(o+":ILSPCodeExtractorsManager"),d=new s.Token(o+":ILSPLogConsole");function h(e,t){return t&&e.line===t.line&&e.ch===t.ch}function u(e,t){let n=0,i=0;for(let s of t){if(!(s.length+1<=e)){i=e;break}e-=s.length+1,n+=1}return{line:n,column:i}}function _(e,t,n=!1){let i=n?0:1,s=0;for(let n=0;n<t.length;n++){let o=t[n];if(!(e.line>n)){s+=e.column;break}s+=o.length+i}return s}class g extends Error{}function p(e,t,n){let i=e.exec(t);if(null==i)return console.warn(`No capture group found for ${e} in ${t}`),-1;let s=0,o=i[0];for(let e of i.slice(1)){if(void 0===e)continue;if(e===n){s+=o.indexOf(e);break}let t=o.indexOf(e)+e.length;o=o.slice(t),s+=t}return s}class m{constructor(e){this.language=e.language,this.options=e,this.global_expression=new RegExp(e.pattern,"g"),this.test_expression=new RegExp(e.pattern,"g"),this.expression=new RegExp(e.pattern),this.standalone=this.options.is_standalone,this.file_extension=this.options.file_extension}has_foreign_code(e){let t=this.test_expression.test(e);return this.test_expression.lastIndex=0,t}extract_foreign_code(e){let t,n,i=e.split("\n"),s=new Array,o=this.global_expression.lastIndex,r=this.global_expression.exec(e),a=!1;if(void 0!==this.options.foreign_replacer)n=this.options.foreign_replacer,a=!0;else if(void 0!==this.options.foreign_capture_groups)n="$"+this.options.foreign_capture_groups.join("$"),a=!0;else{if(!this.options.extract_to_foreign)return console.warn("Foreign replacer not defined for extractor: {this.expression} - this is deprecated; use 'foreign_replacer' to define it"),[];n=this.options.extract_to_foreign}for(;null!=r;){let l=r[0],c=null,d=l.replace(this.expression,n),h="";void 0!==this.options.extract_arguments&&(h=l.replace(this.expression,this.options.extract_arguments),c=u(h.length,h.split("\n")));let _=this.global_expression.lastIndex;t=this.options.keep_in_host||null==this.options.keep_in_host?e.substring(o,_):o===r.index?"":e.substring(o,r.index)+"\n";let g=d;a&&(g=l.replace(this.expression,"$"+Math.min(...this.options.foreign_capture_groups)));const m=p(this.expression,l,g);let f=r.index+m,v=u(f,i),w=u(f+d.length,i);s.push({host_code:t,foreign_code:h+d,range:{start:v,end:w},virtual_shift:c}),o=this.global_expression.lastIndex,r=this.global_expression.exec(e)}if(o!==e.length){let t=e.substring(o,e.length);s.push({host_code:t,foreign_code:null,range:null,virtual_shift:null})}return s}}const f=new s.Token(o+":ILSPCodeOverridesManager");var v=n(1539),w=n(5215),y=n(4026),b=n(2586),x=n(2233),k=n(5600),C=n(8673),S=n(1490),M=n(2230),E=n(8077),j=n(6168),I=n(6062),T=n.n(I),L=n(4599);T()(L.Z,{insert:"head",singleton:!1}),L.Z.locals;class R{constructor(e){this.shell=e,this.adapters=new Map,this.adapterChanged=new j.Signal(this),this.adapterDisposed=new j.Signal(this),this.adapterTypeAdded=new j.Signal(this),this.adapterTypes=[],e.currentChanged.connect(this.refreshAdapterFromCurrentWidget,this)}get types(){return this.adapterTypes}registerAdapterType(e){this.adapterTypes.push(e),this.adapterTypeAdded.emit(e)}connect(e,t){t.tracker.widgetAdded.connect(((n,i)=>{this.connectWidget(e,i,t)})),e.registerAdapterType(this,t)}registerExtension(e){for(let t of this.adapterTypes)this.connect(e,t);this.adapterTypeAdded.connect(((t,n)=>{this.connect(e,n)}))}connectWidget(e,t,n){let i=new n.adapter(e,t);this.registerAdapter({adapter:i,id:n.get_id(t),re_connector:()=>{this.connectWidget(e,t,n)}}),this.refreshAdapterFromCurrentWidget()}refreshAdapterFromCurrentWidget(){const e=this.shell.currentWidget;if(!e)return;let t=null;for(let n of this.adapterTypes)if(n.tracker.has(e)){let i=n.get_id(e);t=this.adapters.get(i)}null!=t&&(this.currentAdapter=t,this.adapterChanged.emit(t))}registerAdapter(e){let{id:t,adapter:n,re_connector:i}=e,s=e.adapter.widget;if(this.adapters.has(t)){let e=this.adapters.get(t);console.warn(`Adapter with id ${t} was already registered (${n} vs ${e}) `)}this.adapters.set(t,n);const o=()=>{this.adapters.delete(t),s.disposed.disconnect(o),s.context.pathChanged.disconnect(r),n.dispose()},r=()=>{o(),i()};s.disposed.connect((()=>{o(),this.adapterDisposed.emit(n)})),s.context.pathChanged.connect(r),this.refreshAdapterFromCurrentWidget()}isAnyActive(){return null!==this.shell.currentWidget&&this.adapterTypes.some((e=>e.tracker.currentWidget))&&this.adapterTypes.some((e=>e.tracker.currentWidget==this.shell.currentWidget))}}const D={id:o+":ILSPAdapterManager",activate:e=>{let t=e.shell;return new R(t)},provides:a,autoStart:!0};var P=n(6599);class A{static lsp_to_cm(e){return{line:e.line,ch:e.character}}static cm_to_lsp(e){return{line:e.line,character:e.ch}}static lsp_to_ce(e){return{line:e.line,column:e.character}}static cm_to_ce(e){return{line:e.line,column:e.ch}}static ce_to_cm(e){return{line:e.line,ch:e.column}}}var O,z=n(2451),$=n(6988);class F{constructor(e){this.on_new_connection=e=>{e.on("error",(t=>{this.console.warn(t);let n=t.length&&t.length>=1?t[0]:new Error;-1!==n.message.indexOf("code = 1005")?(this.console.warn(`Connection failed for ${e}`),this.forEachDocumentOfConnection(e,(t=>{this.console.warn("disconnecting "+t.uri),this.closed.emit({connection:e,virtual_document:t}),this.ignored_languages.add(t.language),this.console.warn(`Cancelling further attempts to connect ${t.uri} and other documents for this language (no support from the server)`)}))):-1!==n.message.indexOf("code = 1006")?this.console.warn("Connection closed by the server"):this.console.error("Connection error:",t)})),e.on("serverInitialized",(t=>{this.forEachDocumentOfConnection(e,(t=>{this.initialized.emit({connection:e,virtual_document:t})})),this.updateServerConfigurations(this.initial_configurations)})),e.on("close",(t=>{t?(this.console.warn("Connection closed"),this.forEachDocumentOfConnection(e,(t=>{this.closed.emit({connection:e,virtual_document:t})}))):this.console.warn("Connection unexpectedly disconnected")}))},this.connections=new Map,this.documents=new Map,this.ignored_languages=new Set,this.connected=new j.Signal(this),this.initialized=new j.Signal(this),this.disconnected=new j.Signal(this),this.closed=new j.Signal(this),this.documents_changed=new j.Signal(this),this.language_server_manager=e.language_server_manager,this.console=e.console,O.setLanguageServerManager(e.language_server_manager)}connect_document_signals(e){e.foreign_document_opened.connect(this.on_foreign_document_opened,this),e.foreign_document_closed.connect(this.on_foreign_document_closed,this),this.documents.set(e.uri,e),this.documents_changed.emit(this.documents)}disconnect_document_signals(e,t=!0){e.foreign_document_opened.disconnect(this.on_foreign_document_opened,this),e.foreign_document_closed.disconnect(this.on_foreign_document_closed,this),this.documents.delete(e.uri);for(const t of e.foreign_documents.values())this.disconnect_document_signals(t,!1);t&&this.documents_changed.emit(this.documents)}on_foreign_document_opened(e,t){this.console.log("ConnectionManager received foreign document: ",t.foreign_document.uri)}on_foreign_document_closed(e,t){const{foreign_document:n}=t;this.disconnect_document_signals(n)}async connect_socket(e){this.console.log("Connection Socket",e);let{virtual_document:t,language:n,capabilities:i}=e;this.connect_document_signals(t);const s=F.solve_uris(t,n),o=this.language_server_manager.getMatchingServers({language:n});this.console.debug("Matching servers: ",o);const r=0===o.length?null:o[0],a=await O.connection(n,r,s,this.on_new_connection,this.console,i);return this.connections.set(t.uri,a),a}updateConfiguration(e){this.language_server_manager.setConfiguration(e)}updateServerConfigurations(e){let t;for(t in e){if(!e.hasOwnProperty(t))continue;const n=e[t],i={settings:(0,$.HY)(n.serverSettings||{})};this.console.log("Server Update: ",t),this.console.log("Sending settings: ",i),O.updateServerConfiguration(t,i)}}forEachDocumentOfConnection(e,t){for(const[n,i]of this.connections.entries())e===i&&t(this.documents.get(n))}async retry_to_connect(e,t,n=-1){let{virtual_document:i}=e;if(this.ignored_languages.has(i.language))return;let s=1e3*t,o=!1;for(;0!==n&&!o;)await this.connect(e).then((()=>{o=!0})).catch((e=>{this.console.warn(e)})),this.console.log("will attempt to re-connect in "+s/1e3+" seconds"),await(0,$._v)(s),s=s<5e3?s+500:s}async connect(e,t=30,n=5){this.console.log("connection requested",e);let i=await this.connect_socket(e),{virtual_document:s,document_path:o}=e;if(!i.isReady)try{await(0,$.EU)((()=>i.isReady),Math.round(1e3*t/150),150)}catch(e){this.console.warn(`Connection to ${s.uri} timed out after ${t} seconds, will continue retrying for another ${n} minutes`);try{await(0,$.EU)((()=>i.isReady),60*n,1e3)}catch(e){return void this.console.warn(`Connection to ${s.uri} timed out again after ${n} minutes, giving up`)}}return this.console.log(o,s.uri,"connected."),this.connected.emit({connection:i,virtual_document:s}),i}unregister_document(e){this.connections.delete(e.uri),this.documents_changed.emit(this.documents)}updateLogging(e,t){for(const n of this.connections.values())n.logAllCommunication=e,null!==t&&n.clientNotifications["$/setTrace"].emit({value:t})}}!function(e){e.solve_uris=function(e,t){const n=z.PageConfig.getBaseUrl().replace(/^http/,"ws"),s=z.PageConfig.getOption("rootUri"),o=z.PageConfig.getOption("virtualDocumentsUri"),r=e.has_lsp_supported_file?s:o,a=O.getLanguageServerManager().getMatchingServers({language:t}),l=0===a.length?null:a[0];if(null===l)throw`No language server installed for language ${t}`;let c=z.URLExt.join(r,e.uri);return!c.startsWith("file:///")&&c.startsWith("file://")&&(c=c.replace("file://","file:///"),c.startsWith("file:///users/")&&r.startsWith("file:///Users/")&&(c=c.replace("file:///users/","file:///Users/"))),{base:r,document:c,server:z.URLExt.join("ws://jupyter-lsp",t),socket:z.URLExt.join(n,i.URL_NS,"ws",l)}}}(F||(F={})),function(e){const t=new Map;let i,s;e.getLanguageServerManager=function(){return s},e.setLanguageServerManager=function(e){s=e},e.connection=async function(e,s,o,r,a,l){null==i&&(i=n.e(16).then(n.bind(n,7500)));const{LSPConnection:c}=await i;let d=t.get(s);if(null==d){const n=new WebSocket(o.socket),i=new c({languageId:e,serverUri:o.server,rootUri:o.base,serverIdentifier:s,console:a,capabilities:l});i.setMaxListeners(999),t.set(s,i),i.connect(n),r(i)}return d=t.get(s),d},e.updateServerConfiguration=function(e,n){const i=t.get(e);i&&i.sendConfigurationChange(n)}}(O||(O={}));class q extends Map{constructor(e){super(e.map((e=>[new RegExp(e.pattern),e.replacement])))}_override_for(e){for(let[t,n]of this)if(e.match(t))return e.replace(t,n);return null}}class H extends q{constructor(e){super(e),this.overrides=e}get reverse(){return this.type(this.overrides.filter((e=>null!=e.reverse)).map((e=>e.reverse)))}type(e){return new H(e)}override_for(e){return super._override_for(e)}replace_all(e,t=this){let n=new Array,i=new Array;for(let s=0;s<e.length;s++){let o=e[s],r=t.override_for(o);n.push(null==r?o:r),i.push(null!=r)}return{lines:n,skip_inspect:i}}reverse_replace_all(e){return this.replace_all(e,this.reverse).lines}}var W=n(4988);function N(e){return e.map((e=>{let t;if("string"==typeof e)return e;try{t=JSON.stringify({k:e}).slice(5,-1)}catch(n){t=""+e}return'<span class="lsp-code">'+t+"</span>"})).join(" ")}T()(W.Z,{insert:"head",singleton:!1}),W.Z.locals;class U{constructor(e=["LSP"],t=null){t?this.element=t:(this.element=document.createElement("ul"),this.element.className="lsp-floating-console",document.body.appendChild(this.element))}bindThis(){return this}dispose(){this.element.remove()}append(e,t="log"){let n=document.createElement("li");n.innerHTML='<span class="lsp-kind">'+t+"</span>"+e,this.element.appendChild(n),this.element.scrollTop=this.element.scrollHeight}debug(...e){this.append(N(e),"debug")}log(...e){this.append(N(e),"log")}warn(...e){this.append(N(e),"warn")}error(...e){this.append(N(e),"error")}}class V{constructor(){this.debug=window.console.debug.bind(window.console),this.log=window.console.log.bind(window.console),this.warn=window.console.warn.bind(window.console),this.error=window.console.error.bind(window.console)}dispose(){}scope(e){return this}bindThis(){return window.console}}class B{constructor(e=["LSP"],t){this.breadcrumbs=e,this._scope=this.breadcrumbs.join(".")+":",this.singleton=t,this.singleton.changed.connect(this._rebind_functions.bind(this)),this._rebind_functions()}_rebind_functions(){const e=()=>{},t=this.implementation.bindThis();"debug"===this.verbosity?this.debug=this.implementation.debug.bind(t,this._scope):this.debug=e,"debug"===this.verbosity||"log"===this.verbosity?this.log=this.implementation.log.bind(t,this._scope):this.log=e,"debug"===this.verbosity||"log"===this.verbosity||"warn"===this.verbosity?this.warn=this.implementation.warn.bind(t,this._scope):this.warn=e,this.error=this.implementation.error.bind(t,this._scope)}get verbosity(){return this.singleton.verbosity}get implementation(){return this.singleton.implementation}debug(...e){return this.implementation.debug(this._scope,...e)}log(...e){return this.implementation.log(this._scope,...e)}warn(...e){return this.implementation.warn(this._scope,...e)}error(...e){return this.implementation.error(this._scope,...e)}scope(e){return new B([...this.breadcrumbs,e],this.singleton)}}class K{constructor(e){this.verbosity="debug",this.implementation=new V,this.changed=new j.Signal(this),e.load(o+":plugin").then((e=>{this.updateSettings(e),e.changed.connect((()=>{this.updateSettings(e)}))})).catch(console.warn)}updateSettings(e){const t=e.composite,n=t.loggingConsole;this.implementation&&this.implementation.dispose(),"browser"===n?this.implementation=new V:"floating"===n?this.implementation=new U:(console.warn("Unknown console type",n,"falling back to browser console"),this.implementation=new V),this.verbosity=t.loggingLevel,this.changed.emit()}}const Z={id:o+":ILSPLogConsole",requires:[x.ISettingRegistry],activate:(e,t)=>{const n=new K(t);return new B(["LSP"],n)},provides:d,autoStart:!0};function J(e,t){return t.start.line===t.end.line?e.line===t.start.line&&e.column>=t.start.column&&e.column<=t.end.column:e.line===t.start.line&&e.column>=t.start.column&&e.line<t.end.line||e.line>t.start.line&&e.column<=t.end.column&&e.line===t.end.line||e.line>t.start.line&&e.line<t.end.line}class G{constructor(e){this.version=0,this._document=e}get text(){return this._document.value}get uri(){return F.solve_uris(this._document,this.languageId).document}get languageId(){return this._document.language}}class X{constructor(e){this.isDisposed=!1,this.blank_lines_between_cells=2,this.options=e,this.path=e.path,this.console=e.console,this.file_extension=e.file_extension,this.has_lsp_supported_file=e.has_lsp_supported_file,this.parent=e.parent,this.language=e.language;let t=this.language in e.overrides_registry?e.overrides_registry[this.language]:null;this.cell_magics_overrides=new H(t?t.cell:[]),this.line_magics_overrides=new H(t?t.line:[]),this.foreign_extractors_registry=e.foreign_code_extractors,this.foreign_extractors=this.language in this.foreign_extractors_registry?this.foreign_extractors_registry[this.language]:[],this.virtual_lines=new Map,this.source_lines=new Map,this.foreign_documents=new Map,this.overrides_registry=e.overrides_registry,this.standalone=e.standalone||!1,this.instance_id=X.instances_count,X.instances_count+=1,this.unused_standalone_documents=new $.Gl((()=>new Array)),this._remaining_lifetime=6,this.foreign_document_closed=new j.Signal(this),this.foreign_document_opened=new j.Signal(this),this.changed=new j.Signal(this),this.unused_documents=new Set,this.document_info=new G(this),this.update_manager=new Q(this,e.console),this.clear()}dispose(){if(!this.isDisposed){this.isDisposed=!0,this.parent=null;for(const e of this.foreign_documents.values())e.dispose();this.close_all_foreign_documents(),this.update_manager.dispose(),this.foreign_documents.clear(),this.source_lines.clear(),this.unused_documents.clear(),this.unused_standalone_documents.clear(),this.virtual_lines.clear(),this.cell_magics_overrides=null,this.document_info=null,this.foreign_extractors=null,this.foreign_extractors_registry=null,this.line_magics_overrides=null,this.line_blocks=null,this.overrides_registry=null}}get remaining_lifetime(){return this.parent?this._remaining_lifetime:1/0}set remaining_lifetime(e){this.parent&&(this._remaining_lifetime=e)}clear(){this.unused_standalone_documents.clear();for(let e of this.foreign_documents.values())e.clear(),e.standalone&&this.unused_standalone_documents.get(e.language).push(e);this.unused_documents=new Set(this.foreign_documents.values()),this.virtual_lines.clear(),this.source_lines.clear(),this.last_virtual_line=0,this.last_source_line=0,this.line_blocks=[]}forward_closed_signal(e,t){this.foreign_document_closed.emit(t)}forward_opened_signal(e,t){this.foreign_document_opened.emit(t)}open_foreign(e,t,n){let i=new X(Object.assign(Object.assign({},this.options),{parent:this,standalone:t,file_extension:n,language:e}));const s={foreign_document:i,parent_host:this};return this.foreign_document_opened.emit(s),i.foreign_document_closed.connect(this.forward_closed_signal,this),i.foreign_document_opened.connect(this.forward_opened_signal,this),this.foreign_documents.set(i.virtual_id,i),i}document_at_source_position(e){let t=this.source_lines.get(e.line);if(null==t)return this;let n={line:t.editor_line,column:e.ch};for(let[e,{virtual_document:i}]of t.foreign_documents_map)if(J(n,e)){let t={line:n.line-e.start.line,ch:n.column-e.start.column};return i.document_at_source_position(t)}return this}is_within_foreign(e){let t=this.source_lines.get(e.line),n={line:t.editor_line,column:e.ch};for(let[e]of t.foreign_documents_map)if(J(n,e))return!0;return!1}virtual_position_at_document(e){let t=this.source_lines.get(e.line);if(null==t)throw new g("Source line not mapped to virtual position");let n=t.virtual_line,i={line:t.editor_line,column:e.ch};for(let[e,{virtual_line:n,virtual_document:s}]of t.foreign_documents_map)if(J(i,e)){let t={line:i.line-e.start.line,ch:i.column-e.start.column};return s.is_within_foreign(t)?this.virtual_position_at_document(t):(t.line+=n,t)}return{ch:e.ch,line:n}}choose_foreign_document(e){let t,n=this.foreign_documents.has(e.language);if(!e.standalone&&n)t=this.foreign_documents.get(e.language),this.unused_documents.delete(t);else{let n=this.unused_standalone_documents.get(e.language);e.standalone&&n.length>0?(t=n.pop(),this.unused_documents.delete(t)):t=this.open_foreign(e.language,e.standalone,e.file_extension)}return t}extract_foreign_code(e,t){let n=new Map,i=e.value;for(let s of this.foreign_extractors){if(!s.has_foreign_code(i))continue;let o=s.extract_foreign_code(i),r="";for(let i of o){if(null!==i.foreign_code){if(null===i.range){this.console.warn("Failure in foreign code extraction: `range` is null but `foreign_code` is not!");continue}let o=this.choose_foreign_document(s);n.set(i.range,{virtual_line:o.last_virtual_line,virtual_document:o,editor:e.ce_editor});let r={line:t.line+i.range.start.line,column:t.column+i.range.start.column};o.append_code_block({value:i.foreign_code,ce_editor:e.ce_editor},r,i.virtual_shift)}null!=i.host_code&&(r+=i.host_code)}i=r}return{cell_code_kept:i,foreign_document_map:n}}decode_code_block(e){let t=this.cell_magics_overrides.reverse.override_for(e);return null!=t?t:this.line_magics_overrides.reverse_replace_all(e.split("\n")).join("\n")}prepare_code_block(e,t={line:0,column:0}){let n,i,{cell_code_kept:s,foreign_document_map:o}=this.extract_foreign_code(e,t),r=s,a=this.cell_magics_overrides.override_for(r);if(null!=a)n=a.split("\n"),i=n.map((e=>[this.id_path]));else{let e=this.line_magics_overrides.replace_all(r.split("\n"));n=e.lines,i=e.skip_inspect.map((e=>e?[this.id_path]:[]))}return{lines:n,foreign_document_map:o,skip_inspect:i}}get foreign_document_maps(){let e=new Set;for(let t of this.source_lines.values())e.add(t.foreign_documents_map);return[...e.values()]}append_code_block(e,t={line:0,column:0},n){let i=e.value,s=e.ce_editor;if(this.isDisposed)return void console.warn("Cannot append code block: document disposed");let o=i.split("\n"),{lines:r,foreign_document_map:a,skip_inspect:l}=this.prepare_code_block(e,t);for(let e=0;e<r.length;e++)this.virtual_lines.set(this.last_virtual_line+e,{skip_inspect:l[e],editor:s,source_line:this.last_source_line+e});for(let e=0;e<o.length;e++)this.source_lines.set(this.last_source_line+e,{editor_line:e,editor_shift:{line:t.line-((null==n?void 0:n.line)||0),column:0===e?t.column-((null==n?void 0:n.column)||0):0},editor:s,foreign_documents_map:a,virtual_line:this.last_virtual_line+e});this.last_virtual_line+=r.length,this.line_blocks.push(r.join("\n")+"\n");for(let e=0;e<this.blank_lines_between_cells;e++)this.virtual_lines.set(this.last_virtual_line+e,{skip_inspect:[this.id_path],editor:s,source_line:null});this.last_virtual_line+=this.blank_lines_between_cells,this.last_source_line+=o.length}get value(){let e="\n".repeat(this.blank_lines_between_cells);return this.line_blocks.join(e)}get last_line(){const e=this.line_blocks[this.line_blocks.length-1].split("\n");return e[e.length-1]}close_expired_documents(){for(let e of this.unused_documents.values())e.remaining_lifetime-=1,e.remaining_lifetime<=0&&this.close_foreign(e)}close_foreign(e){console.log("LSP: closing document",e),this.foreign_document_closed.emit({foreign_document:e,parent_host:this}),this.foreign_documents.delete(e.virtual_id),e.close_all_foreign_documents(),e.foreign_document_closed.disconnect(this.forward_closed_signal,this),e.foreign_document_opened.disconnect(this.forward_opened_signal,this)}close_all_foreign_documents(){for(let e of this.foreign_documents.values())this.close_foreign(e)}get virtual_id(){return this.standalone?this.instance_id+"("+this.language+")":this.language}get ancestry(){return this.parent?this.parent.ancestry.concat([this]):[this]}get id_path(){return this.parent?this.parent.id_path+"-"+this.virtual_id:this.virtual_id}get uri(){const e=encodeURI(this.path);return this.parent?e+"."+this.id_path+"."+this.file_extension:e}transform_source_to_editor(e){let t=this.source_lines.get(e.line),n=t.editor_line,i=t.editor_shift;return{ch:e.ch+(0===n?i.column:0),line:n+i.line}}transform_virtual_to_editor(e){let t=this.transform_virtual_to_source(e);return null==t?null:this.transform_source_to_editor(t)}transform_virtual_to_source(e){const t=this.virtual_lines.get(e.line).source_line;return null==t?null:{ch:e.ch,line:t}}get root(){return null==this.parent?this:this.parent.root}get_editor_at_virtual_line(e){let t=e.line;return this.virtual_lines.has(t)||(t-=1),this.virtual_lines.get(t).editor}get_editor_at_source_line(e){return this.source_lines.get(e.line).editor}maybe_emit_changed(){this.value!==this.previous_value&&this.changed.emit(this),this.previous_value=this.value;for(let e of this.foreign_documents.values())e.maybe_emit_changed()}}function Y(e){let t=new Set;t.add(e);for(let n of e.foreign_documents.values())Y(n).forEach(t.add,t);return t}X.instances_count=0;class Q{constructor(e,t){this.virtual_document=e,this.is_update_in_progress=!1,this.update_lock=!1,this.isDisposed=!1,this.update_done=new Promise((e=>{e()})),this.document_updated=new j.Signal(this),this.block_added=new j.Signal(this),this.update_began=new j.Signal(this),this.update_finished=new j.Signal(this),this.document_updated.connect(this.on_updated,this),this.console=t||new V}dispose(){this.isDisposed||this.document_updated.disconnect(this.on_updated,this)}on_updated(e,t){try{t.close_expired_documents()}catch(e){this.console.warn("Failed to close expired documents")}}can_update(){return!this.isDisposed&&!this.is_update_in_progress&&!this.update_lock}async with_update_lock(e){await(0,$.EU)((()=>this.can_update()),12,10).then((()=>{try{this.update_lock=!0,e()}finally{this.update_lock=!1}}))}async update_documents(e){let t=new Promise((async(t,n)=>{await(0,$.EU)((()=>this.can_update()),10,5).then((()=>{!this.isDisposed&&this.virtual_document||t();try{this.is_update_in_progress=!0,this.update_began.emit(e),this.virtual_document.clear();for(let t of e)this.block_added.emit({block:t,virtual_document:this.virtual_document}),this.virtual_document.append_code_block(t);this.update_finished.emit(e),this.virtual_document&&(this.document_updated.emit(this.virtual_document),this.virtual_document.maybe_emit_changed()),t()}catch(e){this.console.warn("Documents update failed:",e),n(e)}finally{this.is_update_in_progress=!1}}))}));return this.update_done=t,t}}var ee=n(8644),te=n.n(ee);class ne{constructor(e,t,n=new Array,i){this.editor=e,this.virtual_document=t,this.isDisposed=!1,this.editor.change.connect(this.saveChange,this),this.console=i.scope("EditorAdapter"),this.features=new Map;for(let e of n)e.register(),e.is_registered||this.console.warn("The feature ",e,"was not registered properly"),this.features.set(e.feature.id,e)}async updateAfterChange(){try{await(0,$.EU)((()=>null!=this.last_change),30,22)}catch(e){return void this.console.log("No change obtained from CodeMirror editor within the expected time of 0.66s")}let e,t=this.last_change;try{e=this.editor.get_cursor_position()}catch(e){return void this.console.log("Root position not found")}try{let n=this.editor.document_at_root_position(e);if(this.virtual_document!==n)return!0;if(!t||!t.text.length||!t.text[0].length)return!0;for(let n of this.features.values())try{n.afterChange&&n.afterChange(t,e)}catch(e){console.warn("afterChange of feature",n,"failed with",e)}return!0}catch(e){this.console.log("updateAfterChange failure"),this.console.error(e)}this.invalidateLastChange()}invalidateLastChange(){this.last_change=null}saveChange(e,t){this.last_change=t}dispose(){if(!this.isDisposed){for(let e of this.features.values())e.remove();this.features.clear(),this.editor.change.disconnect(this.saveChange),this.editor=null,this.isDisposed=!0}}}var ie=w.Dialog.createButton;class se{constructor(){this.message="",this.changed=new j.Signal(this),this.timer=null}set(e,t=3e3){this.expire_timer(),this.message=e,this.changed.emit(),-1!==t&&(this.timer=window.setTimeout(this.clear.bind(this),t))}clear(){this.message="",this.changed.emit()}expire_timer(){null!==this.timer&&(window.clearTimeout(this.timer),this.timer=0)}}const oe={"text/x-rsrc":"r","text/x-r-source":"r","text/x-ipython":"python"};class re{constructor(e,t){this.extension=e,this.widget=t,this.isDisposed=!1,this.app=e.app,this.connection_manager=e.connection_manager,this.adapterConnected=new j.Signal(this),this.activeEditorChanged=new j.Signal(this),this.editorRemoved=new j.Signal(this),this.editorAdded=new j.Signal(this),this.adapters=new Map,this.status_message=new se,this.isConnected=!1,this.console=e.console.scope("WidgetAdapter"),this.trans=(e.translator||C.nullTranslator).load("jupyterlab-lsp"),this.widget.context.saveState.connect(this.on_save_state,this),this.connection_manager.closed.connect(this.on_connection_closed,this),this.widget.disposed.connect(this.dispose,this)}get foreign_code_extractors(){return this.extension.foreign_code_extractors}get code_overrides(){return this.extension.code_overrides}on_connection_closed(e,{virtual_document:t}){var n;this.console.log("connection closed, disconnecting adapter",t.id_path),t===(null===(n=this.virtual_editor)||void 0===n?void 0:n.virtual_document)&&this.dispose()}dispose(){var e,t;this.isDisposed||((null===(e=this.virtual_editor)||void 0===e?void 0:e.virtual_document)&&this.disconnect_adapter(null===(t=this.virtual_editor)||void 0===t?void 0:t.virtual_document),this.widget.context.saveState.disconnect(this.on_save_state,this),this.connection_manager.closed.disconnect(this.on_connection_closed,this),this.widget.disposed.disconnect(this.dispose,this),this.disconnect(),this.virtual_editor=null,this.app=null,this.widget=null,this.connection_manager=null,this.widget=null,this.isDisposed=!0)}get widget_id(){return this.widget.id}get language(){if(oe.hasOwnProperty(this.mime_type))return oe[this.mime_type];{let e=this.mime_type.split(";")[0],[t,n]=e.split("/");return"application"===t||"text"===t?n.startsWith("x-")?n.substr(2):n:this.mime_type}}disconnect(){this.connection_manager.unregister_document(this.virtual_editor.virtual_document),this.widget.context.model.contentChanged.disconnect(this.onContentChanged,this);for(let e of this.editors)this.editorRemoved.emit({editor:e});for(let e of this.adapters.values())e.dispose();this.adapters.clear(),this.virtual_editor.dispose()}reload_connection(){null!=this.virtual_editor&&(this.disconnect(),this.init_virtual(),this.connect_document(this.virtual_editor.virtual_document,!0).catch(this.console.warn))}on_save_state(e,t){if(null!=this.virtual_editor&&("completed"===t||"completed manually"===t)){const e=[this.virtual_editor.virtual_document];for(let t of e){let n=this.connection_manager.connections.get(t.uri);this.console.log("Sending save notification for",t.uri,"to",n),n.sendSaved(t.document_info);for(let n of t.foreign_documents.values())e.push(n)}}}update_documents(){if(!this.isDisposed)return this.virtual_editor.virtual_document.update_manager.update_documents(this.editors.map((e=>({ce_editor:e,value:this.virtual_editor.get_editor_value(e)}))));this.console.warn("Cannot update documents: adapter disposed")}get has_multiple_editors(){return this.editors.length>1}async on_connected(e){let{virtual_document:t}=e;this.connect_adapter(e.virtual_document,e.connection),this.adapterConnected.emit(e),this.isConnected=!0;const n=this.update_documents();if(!n)return void this.console.warn("Could not update documents");await n.then((()=>{this.document_changed(t,t,!0),this.console.log("virtual document(s) for",this.document_path,"have been initialized")}));const i=t.uri;let s;if(this.extension.user_console){const e=this.extension.user_console.getLogger(i);s=t=>{e.log({type:"text",data:t})}}else s=e=>console.log(e);e.connection.serverNotifications["$/logTrace"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,"trace",t.uri,i)})),e.connection.serverNotifications["window/logMessage"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,t.uri,i),s(n.serverIdentifier+": "+i.message)})),e.connection.serverNotifications["window/showMessage"].connect(((n,i)=>{this.console.log(e.connection.serverIdentifier,t.uri,i.message),(0,w.showDialog)({title:this.trans.__("Message from ")+n.serverIdentifier,body:i.message})})),e.connection.serverRequests["window/showMessageRequest"].setHandler((async n=>{this.console.log(e.connection.serverIdentifier,t.uri,n);const i=n.actions,s=i?i.map((e=>ie({label:e.title}))):[ie({label:this.trans.__("Dismiss")})],o=await(0,w.showDialog)({title:this.trans.__("Message from ")+e.connection.serverIdentifier,body:n.message,buttons:s}),r=s.indexOf(o.button);return-1===r?null:i?i[r]:null}))}async connect_document(e,t=!1){e.changed.connect(this.document_changed,this),e.foreign_document_opened.connect(this.on_foreign_document_opened,this);const n=await this.connect(e).catch(this.console.warn);t&&(n&&n.connection?n.connection.sendOpenWhenReady(e.document_info):this.console.warn(`Connection for ${e.path} was not opened`))}create_virtual_editor(e){let t=this.extension.editor_type_manager.findBestImplementation(this.editors);return null==t?null:new(0,t.implementation)(e)}init_virtual(){let e=this.create_virtual_editor({adapter:this,virtual_document:this.create_virtual_document()});null!=e?(this.virtual_editor=e,this.connect_contentChanged_signal()):this.console.error("Could not initialize a VirtualEditor for adapter: ",this)}async on_foreign_document_opened(e,t){const{foreign_document:n}=t;await this.connect_document(n,!0),n.foreign_document_closed.connect(this.on_foreign_document_closed,this)}on_foreign_document_closed(e,t){const{foreign_document:n}=t;n.foreign_document_closed.disconnect(this.on_foreign_document_closed,this),n.foreign_document_opened.disconnect(this.on_foreign_document_opened,this),n.changed.disconnect(this.document_changed,this)}document_changed(e,t,n=!1){if(this.isDisposed)return void this.console.warn("Cannot swap document: adapter disposed");let i=this.connection_manager.connections.get(e.uri),s=this.adapters.get(e.id_path);(null==i?void 0:i.isReady)?null!=s?(i.sendFullTextChange(e.value,e.document_info),n||this.virtual_editor.virtual_document.update_manager.with_update_lock((async()=>{await s.updateAfterChange()})).then().catch(this.console.warn)):this.console.log("Skipping document update signal: adapter not ready"):this.console.log("Skipping document update signal: connection not ready")}connect_adapter(e,t,n=null){let i=this.create_adapter(e,t,n);return this.adapters.set(e.id_path,i),i}disconnect_adapter(e){let t=this.adapters.get(e.id_path);this.adapters.delete(e.id_path),null!=t&&t.dispose()}get_features(e){let t=this.adapters.get(e.id_path);return null==t?void 0:t.features}async connect(e){let t=e.language;this.console.log(`will connect using language: ${t}`);let n={textDocument:{synchronization:{dynamicRegistration:!0,willSave:!1,didSave:!0,willSaveWaitUntil:!1}},workspace:{didChangeConfiguration:{dynamicRegistration:!0}}};for(const e of this.extension.feature_manager.features)e.capabilities&&(n=te()(n,e.capabilities));let i={capabilities:n,virtual_document:e,language:t,document_path:this.document_path},s=await this.connection_manager.connect(i);return s?(await this.on_connected({virtual_document:e,connection:s}),{connection:s,virtual_document:e}):void 0}connect_contentChanged_signal(){this.widget.context.model.contentChanged.connect(this.onContentChanged,this)}create_adapter(e,t,n=null){let i=new Array;null===n&&(n=this.extension.feature_manager.features);for(let s of n){let n=new(s.editorIntegrationFactory.get(this.virtual_editor.editor_name))({feature:s,virtual_editor:this.virtual_editor,virtual_document:e,connection:t,status_message:this.status_message,settings:s.settings,adapter:this,trans:this.trans});i.push(n)}let s=new ne(this.virtual_editor,e,i,this.console);return this.console.log("Adapter for",this.document_path,"is ready."),t.sendOpenWhenReady(e.document_info),s}async onContentChanged(e){const t=this.update_documents();t?(this.update_finished=t.catch(this.console.warn),await this.update_finished):this.console.warn("Could not update documents")}get_position_from_context_menu(){let e=this.app.contextMenuHitTest((()=>!0));if(!e)return null;let{left:t,top:n}=e.getBoundingClientRect(),i=this.app._contextMenuEvent;return void 0!==i&&(t=i.clientX,n=i.clientY,i.stopPropagation()),this.virtual_editor.window_coords_to_root_position({left:t,top:n})}get_context(e){if(!this.virtual_editor)return null;let t=this.virtual_editor.document_at_root_position(e),n=this.virtual_editor.root_position_to_virtual_position(e);return{document:t,connection:this.connection_manager.connections.get(t.uri),virtual_position:n,root_position:e,features:this.get_features(t),editor:this.virtual_editor,app:this.app,adapter:this}}get_context_from_context_menu(){let e=this.get_position_from_context_menu();return e?this.get_context(e):null}}class ae extends re{constructor(e,t){super(e,t),this.editor=t.content,this.initialized=new Promise(((e,t)=>{this.init_once_ready().then(e).catch(t)}))}get document_path(){return this.widget.context.path}get mime_type(){const e=this.editor.model.mimeType,t=this.editor.context.contentsModel;return"text/plain"!=e?e:t?this.extension.app.docRegistry.getFileTypeForModel(t).mimeTypes[0]:e}get language_file_extension(){let e=this.document_path.split(".");return e[e.length-1]}get ce_editor(){return this.editor.editor}get activeEditor(){return this.editor.editor}async init_once_ready(){this.editor.context.isReady||await this.editor.context.ready,this.init_virtual(),this.console.log("file ready for connection:",this.path),this.connect_document(this.virtual_editor.virtual_document,!1).catch(this.console.warn),this.editor.model.mimeTypeChanged.connect(this.reload_connection,this)}get_editor_index(e){return 0}get_editor_wrapper(e){return this.wrapper_element}get wrapper_element(){return this.widget.node}get path(){return this.widget.context.path}context_from_active_document(){if(!this.virtual_editor||!this.get_context)return null;let e=this.widget.content.editor.getCursorPosition(),t=A.ce_to_cm(e);return this.get_context(t)}get_editor_index_at(e){return 0}get editors(){return[this.editor.editor]}create_virtual_document(){return new X({language:this.language,file_extension:this.language_file_extension,path:this.document_path,overrides_registry:{},foreign_code_extractors:{},standalone:!0,has_lsp_supported_file:!0,console:this.console})}}const le={id:o+":FileEditorAdapter",requires:[a],optional:[P.IEditorTracker],activate(e,t,n){null===n?console.warn("LSP: no fileEditorTracker - not registering file editor capabilities"):t.registerAdapterType({name:"file_editor",tracker:n,adapter:ae,entrypoint:"file-editor-context-menu",get_id:e=>e.id,context_menu:{selector:".jp-FileEditor",rank_group:0,rank_group_size:4}})},autoStart:!0};var ce=n(4582);class de extends re{constructor(e,t){super(e,t),this.type="code",this.is_ready=()=>{var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&null!=(null===(e=this.widget.context.sessionContext.session)||void 0===e?void 0:e.kernel)},this.ce_editor_to_cell=new Map,this.editor=t.content,this.known_editors_ids=new Set,this.initialized=new Promise(((e,t)=>{this.init_once_ready().then(e).catch(t)}))}async update_language_info(){var e,t,n,i;const s=null===(i=await(null===(n=null===(t=null===(e=this.widget.context.sessionContext)||void 0===e?void 0:e.session)||void 0===t?void 0:t.kernel)||void 0===n?void 0:n.info))||void 0===i?void 0:i.language_info;if(!s)throw new Error("Language info update failed (no session, kernel, or info available)");this._language_info=s}async on_kernel_changed(e,t){if(t.newValue)try{this.console.log("Changed kernel, will try to reconnect");const e=this._language_info;await(0,$.EU)(this.is_ready,-1),await this.update_language_info();const t=this._language_info;(null==e?void 0:e.name)!=t.name||(null==e?void 0:e.mimetype)!=(null==t?void 0:t.mimetype)||(null==e?void 0:e.file_extension)!=(null==t?void 0:t.file_extension)?(this.console.log(`Changed to ${this._language_info.name} kernel, reconnecting`),this.reload_connection()):this.console.log("Keeping old LSP connection as the new kernel uses the same langauge")}catch(e){this.console.warn(e),this.reload_connection()}else this.console.log("Kernel was shut down")}dispose(){this.isDisposed||(this.widget.context.sessionContext.kernelChanged.disconnect(this.on_kernel_changed,this),this.widget.content.activeCellChanged.disconnect(this.activeCellChanged,this),super.dispose(),this.ce_editor_to_cell.clear())}get document_path(){return this.widget.context.path}language_info(){return this._language_info}get mime_type(){let e=this.language_info();return e&&e.mimetype?e.mimetype:this.widget.content.codeMimetype}get language_file_extension(){let e=this.language_info();if(e&&e.file_extension)return e.file_extension.replace(".","")}get wrapper_element(){return this.widget.node}async init_once_ready(){this.console.log("waiting for",this.document_path,"to fully load"),await this.widget.context.sessionContext.ready,await(0,$.EU)(this.is_ready,-1),await this.update_language_info(),this.console.log(this.document_path,"ready for connection"),this.init_virtual(),this.connect_document(this.virtual_editor.virtual_document,!1).catch(this.console.warn),this.widget.context.sessionContext.kernelChanged.connect(this.on_kernel_changed,this),this.widget.content.activeCellChanged.connect(this.activeCellChanged,this),this._connectModelSignals(this.widget),this.editor.modelChanged.connect((e=>{this.console.warn("Model changed, connecting cell change handler; this is not something we were expecting"),this._connectModelSignals(e)}))}_connectModelSignals(e){null===e.model?this.console.warn(`Model is missing for notebook ${e}, cannot connet cell changed signal!`):e.model.cells.changed.connect(this.handle_cell_change,this)}async handle_cell_change(e,t){let n=[],i=[];const s=this.type;if("set"===t.type){let e=[],o=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++)t.oldValues[n].type===s&&t.newValues[n].type!==s?e.push(t.newValues[n]):t.oldValues[n].type!==s&&t.newValues[n].type===s&&o.push(t.newValues[n]);n=o,i=e}}else"add"==t.type&&(n=t.newValues.filter((e=>e.type===s)));(i.length||n.length||"move"===t.type||"remove"===t.type)&&await this.update_documents();for(let e of i){let t=this.widget.content.widgets.find((t=>t.model.id===e.id));t?(this.known_editors_ids.delete(t.editor.uuid),this.editorRemoved.emit({editor:t.editor})):this.console.warn(`Widget for removed cell with ID: ${e.id} not found!`)}for(let e of n){let t=this.widget.content.widgets.find((t=>t.model.id===e.id));t?(this.known_editors_ids.add(t.editor.uuid),this.editorAdded.emit({editor:t.editor})):this.console.warn(`Widget for added cell with ID: ${e.id} not found!`)}}get editors(){if(this.isDisposed)return[];let e=this.widget.content;return this.ce_editor_to_cell.clear(),e.isDisposed?[]:e.widgets.filter((e=>"code"===e.model.type)).map((e=>(this.ce_editor_to_cell.set(e.editor,e),e.editor)))}create_virtual_document(){return new X({language:this.language,path:this.document_path,overrides_registry:this.code_overrides,foreign_code_extractors:this.foreign_code_extractors,file_extension:this.language_file_extension,standalone:!1,has_lsp_supported_file:!1,console:this.console})}get activeEditor(){var e;return null===(e=this.widget.content.activeCell)||void 0===e?void 0:e.editor}activeCellChanged(e,t){t.model.type===this.type&&(this.known_editors_ids.has(t.editor.uuid)||(this.known_editors_ids.add(t.editor.uuid),this.editorAdded.emit({editor:t.editor})),this.activeEditorChanged.emit({editor:t.editor}))}context_from_active_document(){let e=this.widget.content.activeCell;if(null===e)return null;if(!this.virtual_editor||!this.get_context)return null;if(e.model.type!==this.type)return null;let t=e.editor,n=t.getCursorPosition(),i=A.ce_to_cm(n),s=this.virtual_editor;if(null==s)return null;let o=s.transform_from_editor_to_root(t,i);return null==o?(this.console.warn("Could not retrieve current context",s),null):this.get_context(o)}get_editor_index_at(e){let t=this.get_cell_at(e);return this.widget.content.widgets.findIndex((e=>t===e))}get_editor_index(e){let t=this.ce_editor_to_cell.get(e);return this.widget.content.widgets.findIndex((e=>t===e))}get_editor_wrapper(e){return this.ce_editor_to_cell.get(e).node}get_cell_at(e){let t=this.virtual_editor.virtual_document.get_editor_at_virtual_line(e);return this.ce_editor_to_cell.get(t)}}const he={id:o+":NotebookAdapter",requires:[a,ce.INotebookTracker],activate(e,t,n){t.registerAdapterType({name:"notebook",tracker:n,adapter:de,entrypoint:"notebook-cell-context-menu",get_id:e=>e.content.id,context_menu:{selector:".jp-Notebook .jp-CodeCell .jp-Editor",rank_group:10+Number.EPSILON,rank_group_size:4,callback(e){e.add_context_separator(0)}}})},autoStart:!0};class ue extends class{constructor(e){this.add_to_palette=!0,this.category="Language Server Protocol",this.adapter_manager=e.adapter_manager,this.app=e.app,this.palette=e.palette,this.tracker=e.tracker,this.suffix=e.suffix,this.entry_point=e.entry_point}get current_adapter(){return this.adapter_manager.currentAdapter}add(e){for(let t of e){let e=this.create_id(t);this.app.commands.addCommand(e,{execute:()=>this.execute(t),isEnabled:()=>this.is_enabled(t),isVisible:()=>this.is_visible(t),label:t.label,icon:t.icon}),this.should_attach(t)&&this.attach_command(t),this.add_to_palette&&this.palette.addItem({command:e,category:this.category})}}should_attach(e){return null==e.attach_to||e.attach_to.has(this.entry_point)}create_id(e){return"lsp:"+e.id+"-"+this.suffix}}{constructor(e){super(e),this.selector=e.selector,this.entry_point=e.entry_point,this.rank_group=e.rank_group,this.rank_group_size=e.rank_group_size,this.console=e.console,e.callback&&e.callback(this)}attach_command(e){this.app.contextMenu.addItem({selector:this.selector,command:this.create_id(e),rank:this.get_rank(e)})}add_context_separator(e){var t;this.app.contextMenu.addItem({type:"separator",selector:this.selector,rank:(null!==(t=this.rank_group)&&void 0!==t?t:0)+e})}execute(e){let t=this.get_context();t&&e.execute(t)}get is_context_menu_open(){return this.app.contextMenu.menu.isAttached}get is_widget_current(){return null!=this.tracker.currentWidget&&this.tracker.currentWidget===this.app.shell.currentWidget}is_enabled(){return this.is_context_menu_open?function(e){let t=e.get_position_from_context_menu();return!!t&&""!==e.virtual_editor.get_token_at(t).value}(this.current_adapter):this.is_widget_current}get_context(){var e;let t=null;if(this.is_context_menu_open)try{t=this.current_adapter.get_context_from_context_menu()}catch(e){this.console.warn("contextMenu is attached, but could not get the context",e),t=null}if(null==t)try{t=null===(e=this.current_adapter)||void 0===e?void 0:e.context_from_active_document()}catch(e){if(!(e instanceof g))throw e;this.console.log("Could not get context from active document: it is expected when restoring workspace with open files")}return t}is_visible(e){try{let t=this.get_context();return null!=t&&this.current_adapter&&null!=t.connection&&t.connection.isReady&&e.is_enabled(t)}catch(e){return this.console.warn("is_visible failed",e),!1}}get_rank(e){if((void 0===e.is_rank_relative||e.is_rank_relative)&&void 0!==this.rank_group&&this.rank_group_size){let t=void 0!==e.rank?e.rank:0;return this.rank_group+t/this.rank_group_size}return null!=e.rank?e.rank:1/0}}var _e=n(7563),ge=n(6271),pe=n.n(ge),me=n(4929);function fe(e,t){return pe().createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"lsp-external-link"},t)}T()(me.Z,{insert:"head",singleton:!1}),me.Z.locals;const ve=pe().createElement("div",null,pe().createElement("p",null,"It appears that the required Jupyter server extension (",pe().createElement("code",null,"jupyter-lsp"),") is not installed (or not enabled) in this environment."),pe().createElement("h3",null,"What are the likely reasons?"),pe().createElement("ul",null,pe().createElement("li",null,"It might be that you just installed it and need to restart JupyterLab to make it available on startup."),pe().createElement("li",null,"Alternatively, you may be using an older ",pe().createElement("code",null,"notebook")," server instead of the new ",pe().createElement("code",null,"jupyter_server"),"; please refer to the"," ",fe("https://jupyter-server.readthedocs.io/en/latest/operators/migrate-from-nbserver.html","migration guide")," or if you are a JupyterHub user please ensure that you start the JupyterLab using"," ",pe().createElement("code",null,"jupyter_server")," and not the old ",pe().createElement("code",null,"notebook"),", as documented in"," ",fe("https://github.com/jupyterhub/jupyterhub/pull/3329/files","this pull request"),"."),pe().createElement("li",null,"There may be schema errors or language server errors preventing the extension from loading - please check the logs of JupyterLab (in the console where you execute ",pe().createElement("code",null,"jupyter lab"))),pe().createElement("h3",null,"How do I check if the extension is installed?"),pe().createElement("p",null,"Please ensure that ",pe().createElement("code",null,"jupyter server extension list")," includes jupyter-lsp and that it is enabled. If it is enabled please try to restart JupyterLab. If the server extension is installed but not enabled and all other suggestions listed above failed try the following:",pe().createElement("code",null,"jupyter server extension enable --user --py jupyter_lsp"))),we=new _e.LabIcon({name:"lsp:codeWarning",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59M16.95 12.05L10.9 22.5H23m-6.05-8.25l4.141 7.15h-8.283m3.592-4.95v2.2h1.1v-2.2m-1.1 3.3v1.1h1.1v-1.1"/>\n  </g>\n</svg>\n'}),ye=new _e.LabIcon({name:"lsp:codeClock",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59 3.41L2 8l4.59 4.6L8 11.18 4.82 8 8 4.82 6.59 3.41m5.82 0L11 4.82 14.18 8 11 11.18l1.41 1.42L17 8l-4.59-4.59M18.093 21.608a3.998 3.998 0 004.015-4.015 3.998 3.998 0 00-4.015-4.016 3.998 3.998 0 00-4.016 4.016 3.998 3.998 0 004.016 4.015m0-8.923c2.676 0 4.907 2.23 4.907 4.908 0 2.676-2.23 4.907-4.907 4.907s-4.908-2.23-4.908-4.907 2.23-4.908 4.908-4.908m2.498 5.89l-.348.624-2.588-1.428v-2.632h.75v2.141z" />\n  </g>\n</svg>\n'}),be=new _e.LabIcon({name:"lsp:codeCheck",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M6.59,3.41L2,8L6.59,12.6L8,11.18L4.82,8L8,4.82L6.59,3.41M12.41,3.41L11,4.82L14.18,8L11,11.18L12.41,12.6L17,8L12.41,3.41M21.59,11.59L13.5,19.68L9.83,16L8.42,17.41L13.5,22.5L23,13L21.59,11.59Z" />\n  </g>\n</svg>\n'});function xe(e){e&&(e.scrollIntoView(),e.focus())}function ke(e){let{document:t,adapter:n}=e,i=null;if(n.has_multiple_editors){let e=t.virtual_lines.get(0);e?i=n.get_editor_wrapper(e.editor):console.warn("Could not get first line of ",t)}let s=function(e,t,n,i=!0){return n||(n=C.nullTranslator.load("")),e.ancestry.map((e=>{if(!e.parent){let t=e.path;!e.has_lsp_supported_file&&e.file_extension&&t.endsWith(e.file_extension)&&(t=t.slice(0,-e.file_extension.length-1));const n=t;if(i){let e=t.split("/");e.length>2&&(t=e[0]+"/.../"+e[e.length-1])}return pe().createElement("span",{key:e.uri,title:n},t)}if(!e.virtual_lines.size)return pe().createElement("span",{key:e.uri},"Empty document");try{if(t.has_multiple_editors){let i=e.virtual_lines.get(0),s=e.virtual_lines.get(e.last_virtual_line-1),o=t.get_editor_index(i.editor),r=t.get_editor_index(s.editor),a=o===r?n.__("cell %1",o+1):n.__("cells: %1-%2",o+1,r+1);return pe().createElement("span",{key:e.uri},e.language," (",a,")")}}catch(e){console.warn("LSP: could not display document cell location",e)}return pe().createElement("span",{key:e.uri},e.language)}))}(t,n,e.trans);return pe().createElement("div",{className:"lsp-document-locator",onClick:()=>i?xe(i):null},s)}var Ce=w.Dialog.okButton;function Se(e){let t=e.server.spec.languages.map(((e,t)=>pe().createElement("li",{key:t},e)));return pe().createElement("div",{className:"lsp-server-status"},pe().createElement("h5",null,e.server.spec.display_name),pe().createElement("ul",null,t))}class Me extends pe().Component{constructor(e){super(e),this.handleClick=()=>{this.setState((e=>({isCollapsed:!e.isCollapsed})))},this.state={isCollapsed:e.startCollapsed||!1}}render(){const e=this.state.isCollapsed?_e.caretDownIcon:_e.caretUpIcon;return pe().createElement("div",{className:"lsp-collapsible-list "+(this.state.isCollapsed?"lsp-collapsed":"")},pe().createElement("h4",{onClick:this.handleClick},pe().createElement(e.react,{tag:"span",className:"lsp-caret-icon"}),this.props.title,": ",this.props.list.length),pe().createElement("div",null,this.props.list))}}class Ee extends pe().Component{render(){const e=this.props.specs,t=this.props.trans;return pe().createElement("div",null,pe().createElement("h3",null,e.display_name),pe().createElement("div",null,pe().createElement("ul",{className:"lsp-server-links-list"},Object.entries((null==e?void 0:e.urls)||{}).map((([e,t])=>pe().createElement("li",{key:this.props.serverId+"-url-"+e},e,":"," ",pe().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},t))))),pe().createElement("h4",null,t.__("Troubleshooting")),pe().createElement("p",{className:"lsp-troubleshoot-section"},e.troubleshoot?e.troubleshoot:t.__("In case of issues with installation feel welcome to ask a question on GitHub.")),pe().createElement("h4",null,t.__("Installation")),pe().createElement("ul",null,(null==e?void 0:e.install)?Object.entries((null==e?void 0:e.install)||{}).map((([e,t])=>pe().createElement("li",{key:this.props.serverId+"-install-"+e},e,": ",pe().createElement("code",null,t)))):t.__("No installation instructions were provided with this specification."))))}}class je extends pe().Component{constructor(){super(...arguments),this.handleClick=()=>{const e=this.props.trans;(0,w.showDialog)({title:e.__("No language server for %1 detected",this.props.language),body:pe().createElement("div",null,this.props.servers.size?pe().createElement("div",null,pe().createElement("p",null,e._n("There is %1 language server you can easily install that supports %2.","There are %1 language servers you can easily install that supports %2.",this.props.servers.size,this.props.language)),[...this.props.servers.entries()].map((([t,n])=>pe().createElement(Ee,{specs:n,serverId:t,key:t,trans:e})))):pe().createElement("div",null,pe().createElement("p",null,e.__("We do not have an auto-detection ready for a language servers supporting %1 yet.",this.props.language)),pe().createElement("p",null,e.__("You may contribute a specification for auto-detection as described in our ")," ",pe().createElement("a",{href:"https://jupyterlab-lsp.readthedocs.io/en/latest/Contributing.html#specs"},e.__("documentation"))))),buttons:[Ce()]}).catch(console.warn)}}render(){return pe().createElement("button",{type:"button",className:"jp-Button lsp-help-button",onClick:this.handleClick},"?")}}class Ie extends w.VDomRenderer{constructor(e){super(e),this.addClass("lsp-popover")}render(){var e;if(!(null===(e=this.model)||void 0===e?void 0:e.connection_manager))return null;const t=this.model.servers_available_not_in_use.map(((e,t)=>pe().createElement(Se,{key:t,server:e})));let n=new Array,i=-1;for(let[e,t]of this.model.documents_by_server.entries()){i+=1;let s=new Array;for(let[n,o]of t){let t=o.map(((e,t)=>{let n=this.model.connection_manager.connections.get(e.uri),i="";i=(null==n?void 0:n.isInitialized)?"initialized":(null==n?void 0:n.isConnected)?"connected":"not connected";const s="initialized"===i?_e.circleIcon:_e.circleEmptyIcon;return pe().createElement("li",{key:t},pe().createElement(ke,{document:e,adapter:this.model.adapter}),pe().createElement("span",{className:"lsp-document-status"},this.model.trans.__(i),pe().createElement(s.react,{tag:"span",className:"lsp-document-status-icon",elementSize:"small"})))}));s.push(pe().createElement("div",{key:i,className:"lsp-documents-by-language"},pe().createElement("h5",null,n," ",pe().createElement("span",{className:"lsp-language-server-name"},"(",e.spec.display_name,")")),pe().createElement("ul",null,t)))}n.push(pe().createElement("div",{key:i},s))}const s=this.model.missing_languages.map(((e,t)=>{const n=this.model.language_server_manager.getMatchingSpecs({language:e});return pe().createElement("div",{key:t,className:"lsp-missing-server"},e,n.size?pe().createElement(je,{language:e,servers:n,trans:this.model.trans}):"")})),o=this.model.trans;return pe().createElement("div",{className:"lsp-popover-content"},pe().createElement("div",{className:"lsp-servers-menu"},pe().createElement("h3",{className:"lsp-servers-title"},o.__("LSP servers")),pe().createElement("div",{className:"lsp-servers-lists"},t.length?pe().createElement(Me,{key:"available",title:o.__("Available"),list:t,startCollapsed:!0}):"",n.length?pe().createElement(Me,{key:"running",title:o.__("Running"),list:n}):"",s.length?pe().createElement(Me,{key:"missing",title:o.__("Missing"),list:s}):"")),pe().createElement("div",{className:"lsp-popover-status"},o.__("Documentation:")," ",pe().createElement("a",{href:"https://jupyterlab-lsp.readthedocs.io/en/latest/Language%20Servers.html",target:"_blank",rel:"noreferrer"},o.__("Language Servers"))))}}const Te="jp-mod-selected";class Le extends w.VDomRenderer{constructor(e,t=!0,n){super(new Le.Model(e,n)),this.displayText=t,this._popup=null,this.handleClick=()=>{this._popup&&this._popup.dispose(),"no_server_extension"==this.model.status.status?(0,w.showDialog)({title:this.trans.__("LSP server extension not found"),body:ve,buttons:[Ce()]}).catch(console.warn):this._popup=(0,k.showPopup)({body:new Ie(this.model),anchor:this,align:"left"})},this.addClass(k.interactiveItem),this.addClass("lsp-statusbar-item"),this.trans=n,this.title.caption=this.trans.__("LSP status"),this.interactiveStateObserver=new MutationObserver((()=>{const e=this.node.classList.contains(Te);this.node.classList.contains(k.interactiveItem)?e&&this.removeClass(Te):e||this.addClass(Te)}))}onAfterAttach(e){super.onAfterAttach(e),this.interactiveStateObserver.observe(this.node,{attributes:!0,attributeFilter:["class"]})}onBeforeDetach(e){super.onBeforeDetach(e),this.interactiveStateObserver.disconnect()}render(){const{model:e}=this;return null==e?null:pe().createElement(k.GroupItem,{spacing:this.displayText?2:0,title:e.long_message,onClick:this.handleClick,className:"lsp-status-group"},pe().createElement(e.status_icon.react,{top:"2px",kind:"statusBar",title:this.trans.__("LSP Code Intelligence")}),this.displayText?pe().createElement(k.TextItem,{className:"lsp-status-message",source:e.short_message}):pe().createElement(pe().Fragment,null),pe().createElement(k.TextItem,{source:e.feature_message}))}}class Re{constructor(e){this.options=e}createItem(e=!0){const t=new Le(this.options.adapter_manager,e,this.options.translator_bundle);return t.model.language_server_manager=this.options.language_server_manager,t.model.connection_manager=this.options.connection_manager,t}createNew(e,t){const n=this.createItem(!1);return n.addClass("jp-ToolbarButton"),e.toolbar.insertAfter("spacer","LSPStatus",n),n}}const De={no_server_extension:"error",waiting:"inactive",initialized:"ready",initializing:"preparing",initialized_but_some_missing:"ready",connecting:"preparing"},Pe={no_server_extension:we,waiting:ye,initialized:be,initializing:ye,initialized_but_some_missing:we,connecting:ye},Ae={no_server_extension:"Server extension missing",waiting:"Waiting...",initialized:"Fully initialized",initialized_but_some_missing:"Initialized (additional servers needed)",initializing:"Initializing...",connecting:"Connecting..."};!function(e){class t extends w.VDomModel{constructor(e,t){super(),this.server_extension_status=null,this._onChange=()=>{this.stateChanged.emit(void 0)},this._adapter=null,this.trans=t,e.adapterChanged.connect(((e,t)=>{this.change_adapter(t)}),this),e.adapterDisposed.connect(((e,t)=>{this.adapter===t&&this.change_adapter(null)}),this)}get available_servers(){return this.language_server_manager.sessions}get supported_languages(){const e=new Set;for(let t of this.available_servers.values())for(let n of t.spec.languages)e.add(n.toLocaleLowerCase());return e}is_server_running(e,t){for(const t of this.detected_languages){const n=this.language_server_manager.getMatchingServers({language:t});if(n.length&&n[0]===e)return!0}return!1}get documents_by_server(){var e;let t=new Map;if(!(null===(e=this.adapter)||void 0===e?void 0:e.virtual_editor))return t;let n=Y(this.adapter.virtual_editor.virtual_document);for(let e of n.values()){let n=e.language.toLocaleLowerCase(),i=this._connection_manager.language_server_manager.getMatchingServers({language:e.language});if(0===i.length)continue;let s=this.language_server_manager.sessions.get(i[0]);t.has(s)||t.set(s,new Map);let o=t.get(s);o.has(n)||o.set(n,new Array),o.get(n).push(e)}return t}get servers_available_not_in_use(){return[...this.available_servers.entries()].filter((([e,t])=>!this.is_server_running(e,t))).map((([e,t])=>t))}get detected_languages(){var e;return(null===(e=this.adapter)||void 0===e?void 0:e.virtual_editor)?function(e){let t=Y(e);return new Set([...t].map((e=>e.language.toLocaleLowerCase())))}(this.adapter.virtual_editor.virtual_document):new Set}get missing_languages(){return[...this.detected_languages].filter((e=>!this.supported_languages.has(e.toLocaleLowerCase())))}get status(){var e;let t;if(null===(e=this.adapter)||void 0===e?void 0:e.virtual_editor){let e=this.adapter.virtual_editor.virtual_document;const n=this._connection_manager.documents,i=Y(e);t=new Map([...n].filter((([e,t])=>i.has(t))))}else t=new Map;let n=new Set,i=new Set,s=new Set,o=new Set,r=new Set;t.forEach(((e,t)=>{let a=this._connection_manager.connections.get(t);0!==this._connection_manager.language_server_manager.getMatchingServers({language:e.language}).length&&r.add(e),a?(o.add(e),a.isConnected&&n.add(e),a.isInitialized&&i.add(e)):s.add(e)}));let a,l=new Array;return this._connection_manager.connections.forEach(((e,t)=>{e.isConnected&&l.push(e)})),a=404===this.language_server_manager.statusCode?"no_server_extension":0===t.size?"waiting":i.size===t.size?"initialized":i.size===o.size&&t.size>r.size?"initialized_but_some_missing":n.size===o.size?"initializing":"connecting",{open_connections:l,connected_documents:n,initialized_documents:i,detected_documents:new Set([...t.values()]),status:a}}get status_icon(){return this.adapter?Pe[this.status.status].bindprops({className:"lsp-status-icon "+De[this.status.status]}):_e.stopIcon}get short_message(){return this.adapter?this.trans.__(Ae[this.status.status]):this.trans.__("not initialized")}get feature_message(){var e,t;return(null===(t=null===(e=this.adapter)||void 0===e?void 0:e.status_message)||void 0===t?void 0:t.message)||""}get long_message(){if(!this.adapter)return this.trans.__("not initialized");let e=this.status,t="";if("waiting"===e.status)t=this.trans.__("Waiting for documents initialization...");else if("initialized"===e.status)t=this.trans._n("Fully connected & initialized (%2 virtual document)","Fully connected & initialized (%2 virtual document)",e.detected_documents.size,e.detected_documents.size);else if("initializing"===e.status){const n=new Set(e.detected_documents);for(let t of e.initialized_documents.values())n.delete(t);t=this.trans._np("pluralized","Fully connected, but %2/%3 virtual document stuck uninitialized: %4","Fully connected, but %2/%3 virtual documents stuck uninitialized: %4",e.detected_documents.size,n.size,e.detected_documents.size,[...n].map((e=>e.id_path)).join(", "))}else{const n=new Set(e.detected_documents);for(let t of e.connected_documents.values())n.delete(t);t=this.trans._np("pluralized","%2/%3 virtual document connected (%4 connections; waiting for: %5)","%2/%3 virtual documents connected (%4 connections; waiting for: %5)",e.detected_documents.size,e.connected_documents.size,e.detected_documents.size,e.open_connections.length,[...n].map((e=>e.id_path)).join(", "))}return t}get adapter(){return this._adapter}change_adapter(e){null!=this._adapter&&this._adapter.status_message.changed.disconnect(this._onChange),null!=e&&e.status_message.changed.connect(this._onChange),this._adapter=e}get connection_manager(){return this._connection_manager}set connection_manager(e){null!=this._connection_manager&&(this._connection_manager.connected.disconnect(this._onChange),this._connection_manager.initialized.connect(this._onChange),this._connection_manager.disconnected.disconnect(this._onChange),this._connection_manager.closed.disconnect(this._onChange),this._connection_manager.documents_changed.disconnect(this._onChange)),null!=e&&(e.connected.connect(this._onChange),e.initialized.connect(this._onChange),e.disconnected.connect(this._onChange),e.closed.connect(this._onChange),e.documents_changed.connect(this._onChange)),this._connection_manager=e}}e.Model=t}(Le||(Le={}));class Oe{constructor(){this.registry={}}register(e,t){this.registry.hasOwnProperty(t)||(this.registry[t]=[]),this.registry[t].push(e)}}const ze={id:c.name,requires:[],activate:e=>new Oe,provides:c,autoStart:!0};var $e,Fe,qe,He,We,Ne,Ue,Ve,Be=n(2030),Ke=n(6856),Ze=n(5384);class Je{constructor(e,t){this.settingRegistry=e,this.changed=new j.Signal(this),t in e.plugins?this.ready=new Promise((n=>{e.load(t).then((e=>{this.settings=e,n(),this.changed.emit(),e.changed.connect((()=>{this.settings=e,this.changed.emit()}))})).catch(console.warn)})):console.warn(`${t} settings schema could not be found and was not loaded`)}get composite(){return this.settings.composite}set(e,t){this.settings.set(e,t).catch(console.warn)}}function Ge(e,t){return _(A.lsp_to_ce(e),t)}!function(e){e[e.Error=1]="Error",e[e.Warning=2]="Warning",e[e.Information=3]="Information",e[e.Hint=4]="Hint"}($e||($e={})),function(e){e[e.Unnecessary=1]="Unnecessary",e[e.Deprecated=2]="Deprecated"}(Fe||(Fe={})),function(e){e[e.Deprecated=1]="Deprecated"}(qe||(qe={})),function(e){e[e.Text=1]="Text",e[e.Method=2]="Method",e[e.Function=3]="Function",e[e.Constructor=4]="Constructor",e[e.Field=5]="Field",e[e.Variable=6]="Variable",e[e.Class=7]="Class",e[e.Interface=8]="Interface",e[e.Module=9]="Module",e[e.Property=10]="Property",e[e.Unit=11]="Unit",e[e.Value=12]="Value",e[e.Enum=13]="Enum",e[e.Keyword=14]="Keyword",e[e.Snippet=15]="Snippet",e[e.Color=16]="Color",e[e.File=17]="File",e[e.Reference=18]="Reference",e[e.Folder=19]="Folder",e[e.EnumMember=20]="EnumMember",e[e.Constant=21]="Constant",e[e.Struct=22]="Struct",e[e.Event=23]="Event",e[e.Operator=24]="Operator",e[e.TypeParameter=25]="TypeParameter"}(He||(He={})),function(e){e[e.Text=1]="Text",e[e.Read=2]="Read",e[e.Write=3]="Write"}(We||(We={})),function(e){e[e.Invoked=1]="Invoked",e[e.TriggerCharacter=2]="TriggerCharacter",e[e.TriggerForIncompleteCompletions=3]="TriggerForIncompleteCompletions"}(Ne||(Ne={})),function(e){e[e.AutoInvoked=9999]="AutoInvoked"}(Ue||(Ue={})),function(e){e.abap="ABAP",e.bat="Windows Bat",e.bibtex="BibTeX",e.clojure="Clojure",e.coffeescript="Coffeescript",e.c="C",e.cpp="C++",e.csharp="C#",e.css="CSS",e.diff="Diff",e.dart="Dart",e.dockerfile="Dockerfile",e.elixir="Elixir",e.erlang="Erlang",e.fsharp="F#",e["git-commit"]="Git (commit)",e["git-rebase"]="Git (rebase)",e.go="Go",e.groovy="Groovy",e.handlebars="Handlebars",e.html="HTML",e.ini="Ini",e.java="Java",e.javascript="JavaScript",e.javascriptreact="JavaScript React",e.json="JSON",e.latex="LaTeX",e.less="Less",e.lua="Lua",e.makefile="Makefile",e.markdown="Markdown",e["objective-c"]="Objective-C",e["objective-cpp"]="Objective-C++",e.perl="Perl",e.perl6="Perl 6",e.php="PHP",e.powershell="Powershell",e.jade="Pug",e.python="Python",e.r="R",e.razor="Razor (cshtml)",e.ruby="Ruby",e.rust="Rust",e.scss="SCSS (syntax using curly brackets)",e.sass="SCSS (indented syntax)",e.scala="Scala",e.shaderlab="ShaderLab",e.shellscript="Shell Script (Bash)",e.sql="SQL",e.swift="Swift",e.typescript="TypeScript",e.typescriptreact="TypeScript React",e.tex="TeX",e.vb="Visual Basic",e.xml="XML",e.xsl="XSL",e.yaml="YAML"}(Ve||(Ve={}));class Xe{constructor(e){this.feature=e.feature,this.virtual_editor=e.virtual_editor,this.virtual_document=e.virtual_document,this.connection=e.connection,this.status_message=e.status_message,this.adapter=e.adapter,this.console=this.adapter.console.scope(e.feature.name),this.trans=e.trans,this.editor_handlers=new Map,this.connection_handlers=new Map,this.wrapper_handlers=new Map,this.is_registered=!1}get settings(){return this.feature.settings}get lab_integration(){return this.feature.labIntegration}register(){for(let[e,t]of this.editor_handlers)this.virtual_editor.on(e,t);for(let[e,t]of this.connection_handlers)this.connection.on(e,t);this.wrapper=this.virtual_editor.getWrapperElement();for(let[e,t]of this.wrapper_handlers)this.wrapper.addEventListener(e,t);this.is_registered=!0}remove(){for(let[e,t]of this.editor_handlers)this.virtual_editor.off(e,t);this.editor_handlers.clear();for(let[e,t]of this.connection_handlers)this.connection.off(e,t);this.connection_handlers.clear();for(let[e,t]of this.wrapper_handlers)this.wrapper.removeEventListener(e,t);this.wrapper_handlers.clear()}range_to_editor_range(e,t){let n=A.lsp_to_cm(e.start),i=A.lsp_to_cm(e.end);if(null==t){let e=this.transform_virtual_position_to_root_position(n),i=this.virtual_editor.get_editor_at_root_position(e);t=this.virtual_editor.ce_editor_to_cm_editor.get(i)}return{start:this.virtual_document.transform_virtual_to_editor(n),end:this.virtual_document.transform_virtual_to_editor(i),editor:t}}position_from_mouse(e){const t=this.virtual_editor.coordsChar({left:e.clientX,top:e.clientY},"window");return-1===t.line&&-1===t.ch?null:t}transform_virtual_position_to_root_position(e){let t=this.virtual_document.virtual_lines.get(e.line).editor,n=this.virtual_document.transform_virtual_to_editor(e);return this.virtual_editor.transform_from_editor_to_root(t,n)}get_cm_editor(e){return this.virtual_editor.get_cm_editor(e)}get_language_at(e,t){return t.getModeAt(e).name}extract_last_character(e){if("paste"===e.origin){let t=e.text[e.text.length-1];return t[t.length-1]}return e.text[0][0]}highlight_range(e,t){return e.editor.getDoc().markText(e.start,e.end,{className:t})}is_whole_document_edit(e){let t=this.virtual_document.value,n=t.split("\n"),i=e.range,s=A.lsp_to_ce;return 0===_(s(i.start),n)&&_(s(i.end),n)===t.length}async apply_edit(e){let t=this.virtual_document.document_info.uri,n=e.documentChanges?e.documentChanges.map((e=>e)):function(e){let t=[];for(let n of Object.keys(e))t.push({textDocument:{uri:n},edits:e[n]});return t}(e.changes),i=0,s=0,o=!1,r=[];for(let e of n){let n=e.textDocument.uri;if((0,$.Ei)(n,t)){let t;if(o=1===e.edits.length&&this.is_whole_document_edit(e.edits[0]),o)t=e.edits[0],i+=1;else{i=0;let n=this.virtual_document.value,s=n.split("\n"),o=new Map;for(let t of e.edits){let e=Ge(t.range.start,s);o.has(e)?console.warn("Edits should not overlap, ignoring an overlapping edit"):(o.set(e,t),i+=1)}let r=new $.Gl((()=>[])),a="",l=0,c=0,d=0,h=[...o.keys()].sort(((e,t)=>e-t));for(let e of h){let t=o.get(e),i=n.slice(l,e);for(let e=0;e<i.split("\n").length;e++)r.get_or_create(c).push(d),c+=1,d+=1;a+=i+t.newText;let h=Ge(t.range.end,s),u=n.slice(e,h);for(let e=0;e<t.newText.split("\n").length;e++)e<u.length&&(c+=1),d+=1,r.get_or_create(c).push(d);l=h}a+=n.slice(l,n.length),t={range:{start:{line:0,character:0},end:{line:s.length-1,character:s[s.length-1].length}},newText:a},console.assert(this.is_whole_document_edit(t))}s=this.apply_single_edit(t)}else r.push(`Workspace-wide edits not implemented: ${n} != ${t}`)}const a=n.every((e=>0===e.edits.length));return{appliedChanges:i,modifiedCells:s,wasGranular:!o&&!a,errors:r}}replace_fragment(e,t,n,i,s,o,r=!1){let a=this.virtual_document,l=e.split("\n").slice(n.line-s.line,i.line-s.line).join("\n");l.endsWith("\n")&&(l=l.slice(0,-1));let c=this.virtual_editor.ce_editor_to_cm_editor.get(t).getDoc(),d=c.getValue("\n"),{lines:h}=a.prepare_code_block({value:d,ce_editor:t}),u=h.join("\n");if(r){let t=A.cm_to_ce,n=_(t(s),h),i=_(t(o),h);l=u.slice(0,n)+e+u.slice(i)}if(u===l)return 0;let g=a.decode_code_block(l),p=c.getCursor();c.replaceRange(g,{line:0,ch:0},{line:i.line-n.line+1,ch:0});try{c.setCursor(p,p.ch,{scroll:!1})}catch(e){console.log("Could not place the cursor back",e)}return 1}afterChange(e,t){}apply_single_edit(e){let t=this.virtual_document,n=0,i=A.lsp_to_cm(e.range.start),s=A.lsp_to_cm(e.range.end),o=t.get_editor_at_virtual_line(i);if(o!==t.get_editor_at_virtual_line(s)){let r=o,a=i,l=Object.assign({},i),c=i.line,d=!1;for(;c<=s.line;){c++;let o=t.get_editor_at_virtual_line({line:c,ch:0});o===r?(l.line=c,l.ch=0,d=!1):(n+=this.replace_fragment(e.newText,r,a,l,i,s),d=!0,a={line:c,ch:0},l={line:c,ch:0},r=o)}d||(n+=this.replace_fragment(e.newText,r,a,l,i,s))}else n+=this.replace_fragment(e.newText,o,i,s,i,s);return n}}var Ye=n(1674);class Qe{constructor(e,t,n,i,s){this.type=e,this.icon=t,this.match=n,this.connector=i,this.uri=s,this.label=n.label,this._setDocumentation(n.documentation),this._requested_resolution=!1,this._resolved=!1,this._detail=n.detail,this.self=this}get isDocumentationMarkdown(){return this._is_documentation_markdown}_setDocumentation(e){Ye.A_.is(e)?(this._documentation=e.value,this._is_documentation_markdown="markdown"===e.kind):(this._documentation=e,this._is_documentation_markdown=!1)}get insertText(){return this._currentInsertText||this.match.insertText||this.match.label}set insertText(e){this._currentInsertText=e}get sortText(){return this.match.sortText||this.match.label}get filterText(){return this.match.filterText}supportsResolution(){const e=this.connector.get_connection(this.uri);return null!=e&&e.isCompletionResolveProvider()}get detail(){return this._detail}needsResolution(){return!this.documentation&&!this._resolved&&!this._requested_resolution&&this.supportsResolution()}isResolved(){return this._resolved}resolve(){if(this._resolved)return Promise.resolve(this);if(!this.supportsResolution())return Promise.resolve(this);if(this._requested_resolution)return(0,$.EU)((()=>this._resolved),100,50).then((()=>this));const e=this.connector.get_connection(this.uri);return this._requested_resolution=!0,e.getCompletionResolve(this.match).then((e=>null===e?e:(this._setDocumentation(null==e?void 0:e.documentation),this._detail=null==e?void 0:e.detail,this._resolved=!0,this)))}get documentation(){if(this.connector.should_show_documentation)return this._documentation?this._documentation:void 0}get deprecated(){return this.match.deprecated?this.match.deprecated:null!=this.match.tags&&this.match.tags.some((e=>e==Ye.we.Deprecated))}}var et=Be.CompletionHandler.ICompletionItemsResponseType;class tt{constructor(e){if(this.options=e,this.isDisposed=!1,this.responseType=et,this._editor=e.editor,this._connections=e.connections,this.virtual_editor=e.virtual_editor,this._context_connector=new Be.ContextConnector({editor:e.editor}),e.session){let t={editor:e.editor,session:e.session};this._kernel_connector=new Be.KernelConnector(t),this._kernel_and_context_connector=new Be.CompletionConnector(t)}this.lab_integration=e.labIntegration,this.console=e.console}get kernel_completions_first(){return this.options.settings.composite.kernelCompletionsFirst}get use_lsp_completions(){return-1==this.options.settings.composite.disableCompletionsFrom.indexOf("LSP")}get use_kernel_completions(){return-1==this.options.settings.composite.disableCompletionsFrom.indexOf("Kernel")}get suppress_continuous_hinting_in(){return this.options.settings.composite.suppressContinuousHintingIn}get suppress_trigger_character_in(){return this.options.settings.composite.suppressTriggerCharacterIn}get should_show_documentation(){return this.options.settings.composite.showDocumentation}dispose(){this.isDisposed||(this._connections=null,this.virtual_editor=null,this._context_connector=null,this._kernel_connector=null,this._kernel_and_context_connector=null,this.options=null,this._editor=null,this.isDisposed=!0)}get _has_kernel(){var e;return null!=(null===(e=this.options.session)||void 0===e?void 0:e.kernel)}get _is_kernel_idle(){var e,t;return"idle"==(null===(t=null===(e=this.options.session)||void 0===e?void 0:e.kernel)||void 0===t?void 0:t.status)}get _should_wait_for_busy_kernel(){return this.lab_integration.settings.composite.waitForBusyKernel}async _kernel_language(){return(await this.options.session.kernel.info).language_info.name}get _kernel_timeout(){return this.lab_integration.settings.composite.kernelResponseTimeout}get fallback_connector(){return this._kernel_and_context_connector?this._kernel_and_context_connector:this._context_connector}transform_from_editor_to_root(e){let t=A.ce_to_cm(e);return this.virtual_editor.transform_from_editor_to_root(this._editor,t)}async fetch(e){let t=this._editor;const n=t.getCursorPosition(),i=t.getTokenForPosition(n);if(this.trigger_kind==Ue.AutoInvoked){if(i.type&&-1!==this.suppress_continuous_hinting_in.indexOf(i.type))return this.console.debug("Suppressing completer auto-invoke in",i.type),void(this.trigger_kind=Ne.Invoked)}else if(this.trigger_kind==Ne.TriggerCharacter&&i.type&&-1!==this.suppress_trigger_character_in.indexOf(i.type))return this.console.debug("Suppressing completer auto-invoke in",i.type),void(this.trigger_kind=Ne.Invoked);const s=t.getPositionAt(i.offset),o=t.getPositionAt(i.offset+i.value.length);let r=n.column-s.column-1;const a=i.value[n.column-s.column-1];let l=this.transform_from_editor_to_root(s),c=this.transform_from_editor_to_root(o),d=this.transform_from_editor_to_root(n),h=this.virtual_editor,u=h.document_at_root_position(l),_=h.root_position_to_virtual_position(l),g=h.root_position_to_virtual_position(c),p=h.root_position_to_virtual_position(d);const m=this.use_lsp_completions?this.fetch_lsp(i,a,_,g,p,u,r):Promise.resolve(void 0);let f=null;try{const t=this._kernel_timeout;if(this.use_kernel_completions&&this._kernel_connector&&this._has_kernel&&(this._is_kernel_idle||this._should_wait_for_busy_kernel)&&0!=t){const n=await this._kernel_language();if(u.language.toLocaleLowerCase()===n.toLowerCase()){let n,i=this._kernel_connector.fetch(e);n=-1==t?i:Promise.race([i,new Promise((e=>setTimeout((()=>e({start:0,end:0,matches:[],metadata:{}})),t)))]),f=Promise.all([n.catch((e=>e)),m.catch((e=>e))]).then((([e,t])=>{let n=[];return null!=e&&n.push(this.transform_reply(e)),null!=t&&n.push(t),this.merge_replies(n,this._editor)}))}}f||(f=m.catch((t=>(this.console.warn("hint failed",t),this.fallback_connector.fetch(e).then(this.transform_reply)))))}catch(t){this.console.warn("kernel completions failed",t),f=this.fallback_connector.fetch(e).then(this.transform_reply)}return this.console.debug("All promises set up and ready."),f.then((e=>((e=this.suppress_if_needed(e,i,n))&&(this.items=e.items),this.trigger_kind=Ne.Invoked,e)))}get_connection(e){return this._connections.get(e)}async fetch_lsp(e,t,n,i,s,o,r){let a=this.get_connection(o.uri);this.console.debug("Fetching"),this.console.debug("Token:",e,n,i);const l=this.trigger_kind==Ue.AutoInvoked?Ne.Invoked:this.trigger_kind;let c=await a.getCompletion(s,{start:n,end:i,text:e.value},o.document_info,!1,t,l)||[];this.console.debug("Transforming");let d=e.value.slice(0,r+1),h=!0,u=[];c.forEach((t=>{let n=t.kind?He[t.kind]:"",i=t.insertText?t.insertText:t.label;if(i.toLowerCase().startsWith(d.toLowerCase()))h=!1,d!==e.value&&i.toLowerCase().startsWith(e.value.toLowerCase())&&(d=e.value);else if("string"===e.type&&d.includes("/")){const e=d.split("/");if(i.toLowerCase().startsWith(e[e.length-1].toLowerCase())){let n=e.slice(0,-1).join("/")+"/";t.insertText=n+t.insertText,(n.startsWith("'")||n.startsWith('"'))&&(n=n.substr(1)),t.label=n+t.label,h=!1}}let s=new Qe(n,this.icon_for(n),t,this,o.uri);u.push(s)})),this.console.debug("Transformed");let _=e.value.length;h&&_>d.length&&(_=d.length);let g={start:e.offset+(h?_:0),end:e.offset+d.length,items:u,source:{name:"LSP",priority:2}};return g.start>g.end&&console.warn("Response contains start beyond end; this should not happen!",g),g}icon_for(e){return void 0===e&&(e=Ze.OC),this.options.themeManager.get_icon(e)||void 0}transform_reply(e){let t;this.console.log("Transforming kernel reply:",e);const n=(e.metadata||{})._jupyter_types_experimental;return t=n?n.map((e=>({label:e.text,insertText:e.text,type:"<unknown>"===e.type?void 0:e.type,icon:this.icon_for(e.type),sortText:this.kernel_completions_first?"a":"z"}))):e.matches.map((e=>({label:e,insertText:e,sortText:this.kernel_completions_first?"a":"z"}))),{start:e.start,end:e.end,source:{name:"Kernel",priority:1,fallbackIcon:this.icon_for("Kernel")},items:t}}merge_replies(e,t){this.console.debug("Merging completions:",e),(e=e.filter((e=>e instanceof Error?(this.console.warn(`Caught ${e.source.name} completions error`,e),!1):!!e.items.length))).sort(((e,t)=>t.source.priority-e.source.priority)),this.console.debug("Sorted replies:",e);const n=Math.min(...e.map((e=>e.end))),i=Math.min(...e.map((e=>e.start))),s=Math.max(...e.map((e=>e.start)));if(i!=s){const n=t.getCursorPosition(),i=t.getLine(n.line);null==i?this.console.warn("Could not remove prefixes: line is undefined",n.line):e=e.map((e=>{if(e.start==s)return e;let t=i.substring(e.start,s);return this.console.debug(`Removing ${e.source.name} prefix: `,t),Object.assign(Object.assign({},e),{items:e.items.map((e=>(e.insertText=e.insertText.startsWith(t)?e.insertText.substr(t.length):e.insertText,e)))})}))}const o=new Set,r=new Array;for(const t of e)t.items.forEach((e=>{let n=e.insertText.trim();if(o.has(n))return;o.add(n);let i=e;t.source&&(i.source=t.source,i.icon||(i.icon=t.source.fallbackIcon)),r.push(i)}));return this.console.debug("Merged: ",r),{start:s,end:n,source:null,items:r}}list(e){return Promise.resolve(void 0)}remove(e){return Promise.resolve(void 0)}save(e,t){return Promise.resolve(void 0)}suppress_if_needed(e,t,n){if(null==e)return e;if(!this._editor.hasFocus())return this.console.debug("Ignoring completion response: the corresponding editor lost focus"),{start:e.start,end:e.end,items:[]};const i=this._editor.getCursorPosition();return n.line!=i.line||i.column<n.column?(this.console.debug("Ignoring completion response: cursor has receded or changed line"),{start:e.start,end:e.end,items:[]}):this.trigger_kind==Ue.AutoInvoked&&(e.start==e.end||1===e.items.length&&e.items[0].insertText===t.value)?{start:e.start,end:e.end,items:[]}:e}}var nt=n(9850);function it(e){let t=document.createElement("span");return t.textContent=e,t.innerHTML}class st extends Be.CompleterModel{constructor(e={}){super(),this.settings=Object.assign(Object.assign({},st.defaultOptions),e)}completionItems(){let e=this.query;this.query="";let t=super.completionItems();return this.query=e,this._sortAndFilter(e,t)}setCompletionItems(e){if(super.setCompletionItems(e),this.settings.preFilterMatches&&this.current&&this.cursor){const{start:e,end:t}=this.cursor;let n=this.current.text.substring(e,t).trim();(n.startsWith('"')||n.startsWith("'"))&&(n=n.substring(1)),(n.endsWith('"')||n.endsWith("'"))&&(n=n.substring(0,-1)),this.query=n}}_markFragment(e){return`<mark>${e}</mark>`}getFilterText(e){return this.getHighlightableLabelRegion(e)}getHighlightableLabelRegion(e){const t=e.label.indexOf("(");return t>-1?e.label.substring(0,t):e.label}_sortAndFilter(e,t){let n=[];for(let i of t){let t,s=null,o=null,r=e.toLowerCase();if(e?(s=this.getFilterText(i),o=this.settings.caseSensitive?nt.StringExt.matchSumOfSquares(s,e):nt.StringExt.matchSumOfSquares(s.toLowerCase(),r),t=!!o,this.settings.includePerfectMatches||(t=t&&s!=e)):t=!0,t){let t,r,a=null;if(e){let t=it(this.getHighlightableLabelRegion(i));a=t==s?o:nt.StringExt.matchSumOfSquares(t,e)}a?(t=nt.StringExt.highlight(it(i.label),a.indices,this._markFragment).join(""),r=a.score):(t=it(i.label),r=0);const l=Object.create(Object.getPrototypeOf(i),Object.getOwnPropertyDescriptors(i));l.label=t,l.insertText=i.insertText?i.insertText:i.label,n.push({item:l,score:r})}}return n.sort(this.compareMatches),n.map((e=>e.item))}compareMatches(e,t){var n,i,s;const o=e.score-t.score;return 0!==o?o:null!==(s=null===(n=e.item.insertText)||void 0===n?void 0:n.localeCompare(null!==(i=t.item.insertText)&&void 0!==i?i:""))&&void 0!==s?s:0}}!function(e){e.defaultOptions={caseSensitive:!0,includePerfectMatches:!0,preFilterMatches:!0}}(st||(st={}));class ot extends st{getFilterText(e){return e.filterText?e.filterText:super.getFilterText(e)}compareMatches(e,t){const n=e.score-t.score;return 0!==n?n:e.item.sortText.localeCompare(t.item.sortText)}}class rt extends Be.Completer.Renderer{constructor(e){super(),this.options=e,this.ITEM_PLACEHOLDER_CLASS="lsp-detail-placeholder",this.EXTRA_INFO_CLASS="jp-Completer-typeExtended",this.activeChanged=new j.Signal(this),this.itemShown=new j.Signal(this),this.elementToItem=new WeakMap,this.wasActivated=new WeakMap,this.visibilityObserver=new IntersectionObserver((e=>{e.forEach((e=>{if(!e.isIntersecting)return;let t=e.target,n=this.elementToItem.get(t);this.itemShown.emit({item:n,element:t})}))}),{threshold:.25}),this.activityObserver=new MutationObserver((e=>{e.forEach((e=>{let t=e.target;if(!(t instanceof HTMLLIElement))return;let n=!this.wasActivated.get(t);if(t.classList.contains("jp-mod-active")){if(n){this.wasActivated.set(t,!0);let e=this.elementToItem.get(t);this.activeChanged.emit({item:e,element:t})}}else this.wasActivated.set(t,!1)}))}))}getExtraInfo(e){var t,n,i,s,o,r;const a=this.options.integrator.settings.composite.labelExtra;switch(a){case"detail":return(null==e?void 0:e.detail)||"";case"type":return null===(n=null===(t=null==e?void 0:e.type)||void 0===t?void 0:t.toLowerCase)||void 0===n?void 0:n.call(t);case"source":return null===(i=null==e?void 0:e.source)||void 0===i?void 0:i.name;case"auto":return[(null==e?void 0:e.detail)||"",null===(o=null===(s=null==e?void 0:e.type)||void 0===s?void 0:s.toLowerCase)||void 0===o?void 0:o.call(s),null===(r=null==e?void 0:e.source)||void 0===r?void 0:r.name].filter((e=>!!e))[0];default:return this.options.console.warn("labelExtra does not match any of the expected values",a),""}}updateExtraInfo(e,t){const n=this.getExtraInfo(e);n&&(t.getElementsByClassName(this.EXTRA_INFO_CLASS)[0].textContent=n)}createCompletionItemNode(e,t){const n=super.createCompletionItemNode(e,t),i=e.self;return i?(i.element=n,this.elementToItem.set(n,i),this.activityObserver.observe(n,{attributes:!0,attributeFilter:["class"]}),this.visibilityObserver.observe(n),this.updateExtraInfo(i,n)):this.updateExtraInfo(e,n),n}createDocumentationNode(e){if(e.isDocumentationMarkdown&&this.options.markdownRenderer){let t=e.documentation;return this.options.markdownRenderer.renderModel({data:{"text/markdown":t},trusted:!1,metadata:{},setData(e){}}).then((()=>{this.options.markdownRenderer&&this.options.latexTypesetter&&t&&t.includes("$")&&this.options.latexTypesetter.typeset(this.options.markdownRenderer.node)})).catch(this.options.console.warn),this.options.markdownRenderer.node}{let t=document.createElement("pre");return e.documentation&&(t.textContent=e.documentation),t}}}const at=".jp-Completer-docpanel",lt="lsp-completer-placeholder";class ct extends Xe{get settings(){return super.settings}get completionCharacters(){return null!=this._completionCharacters&&this._completionCharacters.length||(this._completionCharacters=this.connection.getLanguageCompletionCharacters()),this._completionCharacters}afterChange(e){let t=this.extract_last_character(e);if(this.completionCharacters.indexOf(t)>-1)return this.virtual_editor.console.log("Will invoke completer after",t),void this.feature.labIntegration.invoke_completer(Ne.TriggerCharacter).catch(this.console.warn);e.text&&1==e.text[0].length&&this.settings.composite.continuousHinting&&this.feature.labIntegration.invoke_completer(Ue.AutoInvoked).catch(this.console.warn)}}class dt{constructor(e,t,n,i,s,o,r){this.app=e,this.completionManager=t,this.settings=n,this.adapterManager=i,this.completionThemeManager=s,this.console=o,this.renderMimeRegistry=r,this.current_adapter=null,this._latestActiveItem=null;const a=this.renderMimeRegistry.createRenderer("text/markdown");this.renderer=new rt({integrator:this,markdownRenderer:a,latexTypesetter:this.renderMimeRegistry.latexTypesetter,console:o.scope("renderer")}),this.renderer.activeChanged.connect(this.active_completion_changed,this),this.renderer.itemShown.connect(this.resolve_and_update,this),n.ready.then((()=>{n.composite.disable||i.adapterChanged.connect(this.swap_adapter,this)})).catch(o.warn),n.changed.connect((()=>{s.set_theme(this.settings.composite.theme),s.set_icons_overrides(this.settings.composite.typesMap),n.composite.disable||(document.body.dataset.lspCompleterLayout=this.settings.composite.layout),this.current_completion_handler&&(this.model.settings.caseSensitive=this.settings.composite.caseSensitive,this.model.settings.includePerfectMatches=this.settings.composite.includePerfectMatches,this.model.settings.preFilterMatches=this.settings.composite.preFilterMatches)}))}fetchDocumentation(e){e&&e.resolve().then((t=>{e.self===this._latestActiveItem.self&&(this.set_doc_panel_placeholder(!1),null!==t&&this.refresh_doc_panel(e))})).catch((t=>{e.self===this._latestActiveItem.self&&this.set_doc_panel_placeholder(!1),this.console.warn(t)}))}active_completion_changed(e,t){let{item:n}=t;if(this._latestActiveItem=n,!n.supportsResolution())return void(n.isDocumentationMarkdown&&this.refresh_doc_panel(n));n.needsResolution()?(this.set_doc_panel_placeholder(!0),this.fetchDocumentation(n)):n.isResolved()?this.refresh_doc_panel(n):this.fetchDocumentation(n);const i=this.current_index,s=this.current_items;if(i-1>=0){const e=s[i-1];this.resolve_and_update_from_item(null==e?void 0:e.self)}if(i+1<s.length){const e=s[i+1];this.resolve_and_update_from_item(null==e?void 0:e.self)}}resolve_and_update_from_item(e){e&&this.resolve_and_update(this.renderer,{item:e,element:e.element})}resolve_and_update(e,t){let{item:n,element:i}=t;n.supportsResolution()?n.isResolved()?this.renderer.updateExtraInfo(n,i):n.resolve().then((e=>{this.renderer.updateExtraInfo(n,i)})).catch((e=>{this.console.warn(e)})):this.renderer.updateExtraInfo(n,i)}swap_adapter(e,t){this.current_adapter&&(this.current_adapter.activeEditorChanged.disconnect(this.set_connector,this),this.current_adapter.adapterConnected.disconnect(this.connect_completion,this)),this.current_adapter=t,this.current_adapter.isConnected&&(this.connect_completion(this.current_adapter),this.set_connector(t,{editor:t.activeEditor})),this.current_adapter.activeEditorChanged.connect(this.set_connector,this),this.current_adapter.adapterConnected.connect(this.connect_completion,this)}connect_completion(e,t){let n=e.activeEditor;if(null==n)return;this.set_completion_connector(e,n),this.current_completion_handler=this.completionManager.register({connector:this.current_completion_connector,editor:n,parent:e.widget},this.renderer);let i=this.completer;i.addClass("lsp-completer"),i.model=new ot({caseSensitive:this.settings.composite.caseSensitive,includePerfectMatches:this.settings.composite.includePerfectMatches,preFilterMatches:this.settings.composite.preFilterMatches})}get completer(){return this.current_completion_handler.completer}get model(){return this.completer.model}invoke_completer(e){let t;return this.current_completion_connector.trigger_kind=e,t=this.adapterManager.currentAdapter instanceof de?"completer:invoke-notebook":"completer:invoke-file",this.app.commands.execute(t).catch((()=>{this.current_completion_connector.trigger_kind=Ne.Invoked}))}set_connector(e,t){this.current_completion_handler||this.connect_completion(e),this.set_completion_connector(e,t.editor),this.current_completion_handler.editor=t.editor,this.current_completion_handler.connector=this.current_completion_connector}get current_items(){return this.model.completionItems()}get current_index(){return this.current_completion_handler.completer._activeIndex}refresh_doc_panel(e){let t=this.current_completion_handler.completer;const n=this.current_items[this.current_index];if(!e||!n||n.insertText!=e.insertText)return;const i=t.node.querySelector(at);if(i)if(i.classList.remove(lt),e.documentation){i.textContent="";const t=this.renderer.createDocumentationNode(e);i.appendChild(t),i.setAttribute("style","")}else i.setAttribute("style","display: none");else this.console.warn("Could not find completer panel to refresh")}set_doc_panel_placeholder(e){const t=this.current_completion_handler.completer.node.querySelector(at);t?e?(t.setAttribute("style",""),t.classList.add(lt)):t.classList.contains(lt)&&(t.setAttribute("style","display: none"),t.classList.remove(lt)):this.console.warn("Could not find completer panel for placeholder")}set_completion_connector(e,t){var n,i;this.current_completion_connector=new tt({editor:t,themeManager:this.completionThemeManager,connections:this.current_adapter.connection_manager.connections,virtual_editor:this.current_adapter.virtual_editor,settings:this.settings,labIntegration:this,session:null===(i=null===(n=this.current_adapter.widget)||void 0===n?void 0:n.sessionContext)||void 0===i?void 0:i.session,console:this.console})}}new _e.LabIcon({name:"lsp:completion",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n     <path d="M5,9.5L7.5,14H2.5L5,9.5M3,4H7V8H3V4M5,20A2,2 0 0,0 7,18A2,2 0 0,0 5,16A2,2 0 0,0 3,18A2,2 0 0,0 5,20M9,5V7H21V5H9M9,19H21V17H9V19M9,13H21V11H9V13Z" />\n  </g>\n</svg>\n'});const ht=o+":completion",ut={id:ht,requires:[r,x.ISettingRegistry,Be.ICompletionManager,a,Ze.kZ,d,Ke.IRenderMimeRegistry],autoStart:!0,activate:(e,t,n,i,s,o,r,a)=>{const l=new Je(n,ht),c=new dt(e,i,l,s,o,r.scope("CompletionLab"),a);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",ct]]),id:ht,name:"LSP Completion",labIntegration:c,settings:l,capabilities:{textDocument:{completion:{dynamicRegistration:!0,completionItem:{snippetSupport:!1,commitCharactersSupport:!0,documentationFormat:["markdown","plaintext"],deprecatedSupport:!0,preselectSupport:!1,tagSupport:{valueSet:[qe.Deprecated]}},contextSupport:!1}}}}})}};var _t=n(3706),gt=n(1691),pt=n(3226);const mt='<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M12 14a2 2 0 012 2 2 2 0 01-2 2 2 2 0 01-2-2 2 2 0 012-2m11.46-5.14l-1.59 6.89L15 14.16l3.8-2.38A7.972 7.972 0 0012 8c-3.95 0-7.23 2.86-7.88 6.63l-1.97-.35C2.96 9.58 7.06 6 12 6c3.58 0 6.73 1.89 8.5 4.72l2.96-1.86z"/>\n  </g>\n</svg>\n',ft=new _e.LabIcon({name:"lsp:jump-to",svgstr:mt}),vt=new _e.LabIcon({name:"lsp:jump-back",svgstr:mt.replace("jp-icon3","lsp-icon-flip-x jp-icon3")}),wt=o+":jump_to";let yt;class bt extends Xe{get jumper(){return this.feature.labIntegration.jumper}get settings(){return super.settings}get modifierKey(){return this.settings.composite.modifierKey}register(){this.editor_handlers.set("mousedown",((e,t)=>{const{button:n}=t;if(0===n&&(0,$.nE)(t,this.modifierKey)){let n=this.position_from_mouse(t);if(null==n)return void this.console.warn("Could not retrieve root position from mouse event to jump to definition");let i=e.document_at_root_position(n),s=e.root_position_to_virtual_position(n);this.connection.getDefinition(s,i.document_info,!1).then((e=>{this.handle_jump(e,i.document_info.uri).catch(this.console.warn)})).catch(this.console.warn),t.preventDefault(),t.stopPropagation()}})),super.register()}get_uri_and_range(e){if(null==e)return;const t=Array.isArray(e)?e:[e];if(0===t.length)return;this.console.log("Will jump to the first of suggested locations:",t);const n=t[0];return"targetUri"in n?{uri:n.targetUri,range:n.targetRange}:"uri"in n?{uri:n.uri,range:n.range}:void this.console.warn("Returned jump location is incorrect (no uri or targetUri):",n)}async handle_jump(e,t){const n=this.get_uri_and_range(e);if(!n)return void this.status_message.set(yt.__("No jump targets found"),2e3);let{uri:i,range:s}=n,o=A.lsp_to_cm(s.start);if((0,$.Ei)(i,t)){let e=this.adapter.get_editor_index_at(o),t=this.virtual_editor.transform_virtual_to_editor(o);if(null===t)return void this.console.warn("Could not jump: conversion from virtual position to editor position failed",o);let n=A.cm_to_ce(t);this.console.log(`Jumping to ${e}th editor of ${i}`),this.console.log("Jump target within editor:",n);let s=this.adapter.widget.context.path;this.jumper.global_jump({line:n.line,column:t.ch,editor_index:e,is_symlink:!1,contents_path:s})}else{let e=A.cm_to_ce(o);this.console.log(`Jumping to external file: ${i}`),this.console.log("Jump target (source location):",e);let t={editor_index:0,line:e.line,column:e.column},n=(0,$.lj)(i);if(null==n&&i.startsWith("file://")&&(n=decodeURI(i.slice(7))),null===n)return void this.console.warn("contents_path could not be resolved");try{return await this.jumper.document_manager.services.contents.get(n,{content:!1}),void this.jumper.global_jump(Object.assign(Object.assign({contents_path:n},t),{is_symlink:!1}))}catch(e){this.console.warn(e)}this.jumper.global_jump(Object.assign(Object.assign({contents_path:z.URLExt.join(".lsp_symlink",n)},t),{is_symlink:!0}))}}}class xt{constructor(e,t,n,i,s){this.settings=e,this.adapterManager=t,this.jumpers=new Map,null!==s&&s.widgetAdded.connect(((e,t)=>{if(t.content.editor instanceof gt.CodeMirrorEditor){let e=new pt.FileEditorJumper(t,i);this.jumpers.set(t.id,e)}})),n.widgetAdded.connect((async(e,t)=>{let n=new pt.NotebookJumper(t,i);this.jumpers.set(t.id,n)}))}get jumper(){let e=this.adapterManager.currentAdapter.widget.id;return this.jumpers.get(e)}}const kt=e=>[{id:"jump-to-definition",execute:async({connection:e,virtual_position:t,document:n,features:i})=>{const s=i.get(wt),o=await(null==e?void 0:e.getDefinition(t,n.document_info,!1));await s.handle_jump(o,n.document_info.uri)},is_enabled:({connection:e})=>!!e&&e.isDefinitionSupported(),label:e.__("Jump to definition"),icon:ft},{id:"jump-back",execute:async({connection:e,virtual_position:t,document:n,features:i})=>{i.get(wt).jumper.global_jump_back()},is_enabled:({connection:e})=>!!e&&e.isDefinitionSupported(),label:e.__("Jump back"),icon:vt,attach_to:new Set}],Ct={id:wt,requires:[r,x.ISettingRegistry,a,ce.INotebookTracker,y.IDocumentManager,C.ITranslator],optional:[P.IEditorTracker],autoStart:!0,activate:(e,t,n,i,s,o,r,a)=>{const l=new Je(n,wt);yt=r.load("jupyterlab-lsp");let c=new xt(l,i,s,o,a);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",bt]]),commands:kt(yt),id:wt,name:"Jump to definition",labIntegration:c,settings:l,capabilities:{textDocument:{declaration:{dynamicRegistration:!0,linkSupport:!0},definition:{dynamicRegistration:!0,linkSupport:!0},typeDefinition:{dynamicRegistration:!0,linkSupport:!0},implementation:{dynamicRegistration:!0,linkSupport:!0}}}}})}};var St=n(2372);T()(St.Z,{insert:"head",singleton:!1}),St.Z.locals;const Mt="lsp-diagnostics-placeholder";class Et extends Map{get all(){return[].concat.apply([],this.values())}}class jt{constructor(e){this.options=e,this.is_visible=!0}render_cell(e,t){return this.options.render_cell(e,t)}sort(e,t){return this.options.sort(e,t)}get id(){return this.options.id}is_available(e){return null==this.options.is_available||this.options.is_available(e)}render_header(e){return pe().createElement(It,{label:this.options.label,id:this.id,listing:e,key:this.id})}}function It(e){const t=e.id===e.listing.sort_key,n=t&&1!==e.listing.sort_direction?_e.caretDownIcon:_e.caretUpIcon;return pe().createElement("th",{key:e.id,onClick:()=>e.listing.sort(e.id),className:t?"lsp-sorted-header":void 0,"data-id":e.id},pe().createElement("div",null,pe().createElement("label",null,e.label),pe().createElement(n.react,{tag:"span",className:"lsp-sort-icon"})))}class Tt extends w.VDomRenderer{constructor(e){super(e),this.sort_key="Severity",this.sort_direction=1;const t=e.trans;this.trans=t,this.severityTranslations={Error:t.__("Error"),Warning:t.__("Warning"),Information:t.__("Information"),Hint:t.__("Hint")},this.columns=[new jt({id:"Virtual Document",label:this.trans.__("Virtual Document"),render_cell:(e,t)=>pe().createElement("td",{key:0},pe().createElement(ke,{document:e.document,adapter:t.adapter,trans:this.trans})),sort:(e,t)=>e.document.id_path.localeCompare(t.document.id_path),is_available:e=>e.db.size>1}),new jt({id:"Message",label:this.trans.__("Message"),render_cell:e=>{let t=function(e){let t=e.message,n=""+e.code;return null!=e.code&&""!==e.code&&t.startsWith(n+"")?t.slice(n.length).trim():t}(e.data.diagnostic);return pe().createElement("td",{key:1},t)},sort:(e,t)=>e.data.diagnostic.message.localeCompare(t.data.diagnostic.message)}),new jt({id:"Code",label:this.trans.__("Code"),render_cell:e=>pe().createElement("td",{key:2},e.data.diagnostic.code),sort:(e,t)=>(e.data.diagnostic.code+"").localeCompare(t.data.diagnostic.source+"")}),new jt({id:"Severity",label:this.trans.__("Severity"),render_cell:e=>{const t=$e[e.data.diagnostic.severity||1];return pe().createElement("td",{key:3},this.severityTranslations[t]||t)},sort:(e,t)=>e.data.diagnostic.severity?t.data.diagnostic.severity&&e.data.diagnostic.severity>t.data.diagnostic.severity?1:-1:1}),new jt({id:"Source",label:this.trans.__("Source"),render_cell:e=>pe().createElement("td",{key:4},e.data.diagnostic.source),sort:(e,t)=>e.data.diagnostic.source?t.data.diagnostic.source?e.data.diagnostic.source.localeCompare(t.data.diagnostic.source):-1:1}),new jt({id:"Cell",label:this.trans.__("Cell"),render_cell:e=>pe().createElement("td",{key:5},e.cell_number),sort:(e,t)=>e.cell_number-t.cell_number||e.data.range.start.line-t.data.range.start.line||e.data.range.start.ch-t.data.range.start.ch,is_available:e=>e.adapter.has_multiple_editors}),new jt({id:"Line:Ch",label:this.trans.__("Line:Ch"),render_cell:e=>pe().createElement("td",{key:6},e.data.range.start.line,":",e.data.range.start.ch),sort:(e,t)=>e.data.range.start.line-t.data.range.start.line||e.data.range.start.ch-t.data.range.start.ch})]}sort(e){e===this.sort_key?this.sort_direction=-1*this.sort_direction:(this.sort_key=e,this.sort_direction=1),this.update()}render(){let e=this.model.diagnostics;const t=this.model.virtual_editor,n=this.model.adapter;if(null==e||null==t||!n)return pe().createElement("div",{className:Mt},this.trans.__("Diagnostics are not available"));if(0===e.size)return pe().createElement("div",{className:Mt},this.trans.__("No issues detected, great job!"));let i=Array.from(e).map((([e,i])=>e.isDisposed?[]:i.map(((i,s)=>{let o=null;if(n.has_multiple_editors){let{index:e}=t.find_editor(i.editor);o=e+1}return{data:i,key:e.uri+","+s,document:e,cell_number:o,editor:t}})))),s=[].concat.apply([],i);this._diagnostics=new Map(s.map((e=>[e.key,e])));let o=this.columns.filter((e=>e.id===this.sort_key))[0],r=o.sort.bind(o),a=s.sort(((e,t)=>r(e,t)*this.sort_direction)),l={db:e,editor:t,adapter:n},c=this.columns.filter((e=>e.is_available(l)&&e.is_visible)),d=a.map((e=>{let t=c.map((t=>t.render_cell(e,l)));return pe().createElement("tr",{key:e.key,"data-key":e.key,onClick:()=>{this.jump_to(e)}},t)})),h=c.map((e=>e.render_header(this)));return pe().createElement("table",{className:"lsp-diagnostics-listing"},pe().createElement("thead",null,pe().createElement("tr",null,h)),pe().createElement("tbody",null,d))}get_diagnostic(e){if(this._diagnostics.has(e))return this._diagnostics.get(e);console.warn("Could not find the diagnostics row with key",e)}jump_to(e){const t=e.data.editor;xe(t.getWrapperElement()),t.getDoc().setCursor(e.data.range.start),t.focus()}}!function(e){class t extends w.VDomModel{constructor(e){super(),this.trans=e}}e.Model=t}(Tt||(Tt={}));const Lt=new _e.LabIcon({name:"lsp:diagnostics",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M19 8c.56 0 1 .43 1 1a1 1 0 01-1 1c-.57 0-1-.45-1-1 0-.57.43-1 1-1M2 2v9c0 2.96 2.19 5.5 5.14 5.91.62 3.01 3.28 5.09 6.36 5.09a6.5 6.5 0 006.5-6.5v-3.69c1.16-.42 2-1.52 2-2.81a3 3 0 00-3-3 3 3 0 00-3 3c0 1.29.84 2.4 2 2.81v3.6c0 2.5-2 4.5-4.5 4.5-2 0-3.68-1.21-4.28-3.01C12 16.3 14 13.8 14 11V2h-4v3h2v6a4 4 0 01-4 4 4 4 0 01-4-4V5h2V2H2z"/>\n  </g>\n</svg>\n'}),Rt="lsp-set-column-visibility",Dt="lsp-jump-to-diagnostic",Pt="lsp-copy-diagnostic",At="lsp-ignore-diagnostic-code",Ot="lsp-ignore-diagnostic-message",zt=new class{constructor(e){this._content=null,this._widget=null,this.is_registered=!1,this.trans=e}get widget(){return null!=this._widget&&null!=this._widget.content.model||(this._widget&&!this._widget.isDisposed&&this._widget.dispose(),this._widget=this.initWidget()),this._widget}get content(){return this.widget.content}initWidget(){this._content=new Tt(new Tt.Model(this.trans)),this._content.model.diagnostics=new Et,this._content.addClass("lsp-diagnostics-panel-content");const e=new w.MainAreaWidget({content:this._content});return e.id="lsp-diagnostics-panel",e.title.label=this.trans.__("Diagnostics Panel"),e.title.closable=!0,e.title.icon=Lt,e}update(){this.widget.isAttached&&this.widget.content.update()}register(e){const t=this.widget;let n=e=>{for(let n of t.content.columns)if(n.id===e)return n},i=new _t.Menu({commands:e.commands});i.title.label=this.trans.__("Panel columns"),e.commands.addCommand(Rt,{execute:e=>{let i=n(e.id);i.is_visible=!i.is_visible,t.update()},label:e=>this.trans.__(e.id),isToggled:e=>{let t=n(e.id);return!!t&&t.is_visible}});for(let e of t.content.columns)i.addItem({command:Rt,args:{id:e.id}});e.contextMenu.addItem({selector:".lsp-diagnostics-listing th",submenu:i,type:"submenu"});let s=new _t.Menu({commands:e.commands});s.title.label=this.trans.__("Ignore diagnostics like this");let o=()=>{let t=e.contextMenuHitTest((e=>"tr"==e.tagName.toLowerCase()));if(t)return this.widget.content.get_diagnostic(t.dataset.key)};s.addItem({command:At}),s.addItem({command:Ot}),e.commands.addCommand(At,{execute:()=>{const e=o();if(!e)return void console.warn("LPS: diagnostics row not found for ignore code execute()");const t=e.data.diagnostic;let n=this.content.model.settings.composite.ignoreCodes;this.content.model.settings.set("ignoreCodes",[...n,t.code]),this.feature.refreshDiagnostics()},isVisible:()=>{const e=o();return!!e&&!!e.data.diagnostic.code},label:()=>{const e=o();if(!e)return"";const t=e.data.diagnostic;return this.trans.__('Ignore diagnostics with "%1" code',t.code)}}),e.commands.addCommand(Ot,{execute:()=>{const e=o();if(!e)return void console.warn("LPS: diagnostics row not found for ignore message execute()");const t=e.data.diagnostic;let n=this.content.model.settings.composite.ignoreMessagesPatterns;var i;this.content.model.settings.set("ignoreMessagesPatterns",[...n,(i=t.message,i.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"))]),this.feature.refreshDiagnostics()},isVisible:()=>{const e=o();return!!e&&!!e.data.diagnostic.message},label:()=>{const e=o();if(!e)return"";const t=e.data.diagnostic;return this.trans.__('Ignore diagnostics with "%1" message',t.message)}}),e.commands.addCommand(Dt,{execute:()=>{const e=o();e?this.widget.content.jump_to(e):console.warn("LPS: diagnostics row not found for jump execute()")},label:this.trans.__("Jump to location"),icon:ft}),e.commands.addCommand(Pt,{execute:()=>{const e=o();if(!e)return void console.warn("LPS: diagnostics row not found for copy execute()");const t=e.data.diagnostic.message;navigator.clipboard.writeText(t).then((()=>{this.content.model.status_message.set(this.trans.__('Successfully copied "%1" to clipboard',t))})).catch((()=>{console.warn("Could not copy with clipboard.writeText interface, falling back"),window.prompt(this.trans.__("Your browser protects clipboard from write operations; please copy the message manually"),t)}))},label:this.trans.__("Copy diagnostics' message"),icon:_e.copyIcon}),e.contextMenu.addItem({selector:".lsp-diagnostics-listing tbody tr",command:Pt}),e.contextMenu.addItem({selector:".lsp-diagnostics-listing tbody tr",command:Dt}),e.contextMenu.addItem({selector:".lsp-diagnostics-listing tbody tr",submenu:s,type:"submenu"}),this.is_registered=!0}}(C.nullTranslator.load("jupyterlab_lsp")),$t=new WeakMap;class Ft extends Xe{constructor(){super(...arguments),this.marked_diagnostics=new Map,this.switchDiagnosticsPanelSource=()=>{zt.trans=this.adapter.trans,zt.content.model.virtual_editor===this.virtual_editor&&zt.content.model.diagnostics==this.diagnostics_db||(zt.content.model.diagnostics=this.diagnostics_db,zt.content.model.virtual_editor=this.virtual_editor,zt.content.model.adapter=this.adapter,zt.content.model.settings=this.settings,zt.content.model.status_message=this.status_message,zt.feature=this,zt.update())},this.handleDiagnostic=(e,t)=>{var n,i;if((0,$.Ei)(t.uri,null===(i=null===(n=this.virtual_document)||void 0===n?void 0:n.document_info)||void 0===i?void 0:i.uri)&&0!==this.virtual_document.last_virtual_line)try{this.last_response=t,this.setDiagnostics(t),zt.update()}catch(e){this.console.warn(e)}}}get settings(){return super.settings}register(){this.connection.serverNotifications["textDocument/publishDiagnostics"].connect(this.handleDiagnostic),this.wrapper_handlers.set("focusin",this.switchDiagnosticsPanelSource),this.unique_editor_ids=new $.Gl((()=>this.unique_editor_ids.size)),this.settings.changed.connect(this.refreshDiagnostics,this),this.adapter.adapterConnected.connect((()=>this.switchDiagnosticsPanelSource())),this.virtual_document.foreign_document_closed.connect(((e,t)=>{this.clearDocumentDiagnostics(t.foreign_document)})),super.register()}clearDocumentDiagnostics(e){this.diagnostics_db.set(e,[])}get diagnostics_db(){return $t.has(this.virtual_editor)||$t.set(this.virtual_editor,new Et),$t.get(this.virtual_editor)}collapseOverlappingDiagnostics(e){const t=new Map,n=new Map;e.forEach((e=>{let i=e.range,s=function(e){return e.start.line+","+e.start.character+","+e.end.line+","+e.end.character}(i);t.set(s,i),n.has(s)?n.get(s).push(e):n.set(s,[e])}));let i=new Map;return n.forEach(((e,n)=>{let s=t.get(n);i.set(s,e)})),i}get defaultSeverity(){return $e[this.settings.composite.defaultSeverity]}filterDiagnostics(e){const t=new Set(this.settings.composite.ignoreCodes),n=this.settings.composite.ignoreMessagesPatterns.map((e=>new RegExp(e)));return e.filter((e=>{let i=e.code;if(null!=i&&t.has(i.toString()))return!1;let s=e.message;return!s||!n.some((e=>e.test(s)))}))}setDiagnostics(e){let t=[];const n=new Set;this.collapseOverlappingDiagnostics(this.filterDiagnostics(e.diagnostics)).forEach(((i,s)=>{const o=A.lsp_to_cm(s.start),r=A.lsp_to_cm(s.end),a=this.virtual_document.last_virtual_line-this.virtual_document.blank_lines_between_cells;if(o.line>a)return void this.console.log(`Out of range diagnostic (${o.line} line > ${a}) was skipped `,i);{let e=this.virtual_document.last_line;if(o.line==a&&o.ch>e.length)return void this.console.log(`Out of range diagnostic (${o.ch} character > ${e.length} at line ${a}) was skipped `,i)}let l;try{let e=this.transform_virtual_position_to_root_position(o);l=this.virtual_editor.document_at_root_position(e)}catch(t){return void this.console.warn(`Could not place inspections from ${e.uri}`," inspections: ",i,"error: ",t)}if(this.virtual_document!==l)return void this.console.log(`Ignoring inspections from ${e.uri}`,` (this region is covered by a another virtual document: ${l.uri})`," inspections: ",i);if(-1!==l.virtual_lines.get(o.line).skip_inspect.indexOf(l.id_path))return void this.console.log("Ignoring inspections silenced for this document:",i);let c,d=l.get_editor_at_virtual_line(o),h=this.virtual_editor.ce_editor_to_cm_editor.get(d),u=l.transform_virtual_to_editor(o);if(null===u)return void this.console.warn("Start in editor could not be be determined for",i);try{c=l.transform_virtual_to_editor(r)}catch(e){this.console.warn("Malformed range for diagnostic",r),c=Object.assign(Object.assign({},u),{ch:u.ch+1})}if(null===c)return void this.console.warn("End in editor could not be be determined for",i);let _={start:u,end:c},g=JSON.stringify({diagnostics:i.map((e=>[e.severity,e.message,e.code,e.source,e.relatedInformation])),range:_,editor:this.unique_editor_ids.get(h)});for(let e of i)t.push({diagnostic:e,editor:h,range:_});if(n.add(g),!this.marked_diagnostics.has(g)){const e=i.map((e=>e.severity||this.defaultSeverity)).sort()[0],t=["cm-lsp-diagnostic","cm-lsp-diagnostic-"+$e[e]],n=[];for(let e of i)e.tags&&n.push(...e.tags);for(const e of new Set(n))t.push("cm-lsp-diagnostic-tag-"+Fe[e]);let s,o={title:i.map((e=>e.message+(e.source?" ("+e.source+")":""))).join("\n"),className:t.join(" ")};try{s=h.getDoc().markText(u,c,o)}catch(e){return void this.console.warn("Marking inspection (diagnostic text) failed:",i,e)}this.marked_diagnostics.set(g,s)}})),this.removeUnusedDiagnosticMarkers(n),this.diagnostics_db.set(this.virtual_document,t)}refreshDiagnostics(){this.last_response&&this.setDiagnostics(this.last_response),zt.update()}removeUnusedDiagnosticMarkers(e){this.marked_diagnostics.forEach(((t,n)=>{e.has(n)||(this.marked_diagnostics.delete(n),t.clear())}))}remove(){this.settings.changed.disconnect(this.refreshDiagnostics,this),this.removeUnusedDiagnosticMarkers(new Set),this.diagnostics_db.clear(),$t.delete(this.virtual_editor),this.unique_editor_ids.clear(),zt.content.model.virtual_editor===this.virtual_editor&&(zt.content.model.virtual_editor=null,zt.content.model.diagnostics=null,zt.content.model.adapter=null),zt.update(),super.remove()}}const qt=o+":diagnostics",Ht=e=>[{id:"show-diagnostics-panel",execute:({app:t,features:n,adapter:i})=>{n.get(qt).switchDiagnosticsPanelSource(),zt.is_registered||(zt.trans=e,zt.register(t));const s=zt.widget;s.isAttached||t.shell.add(s,"main",{ref:i.widget_id,mode:"split-bottom"}),t.shell.activateById(s.id)},is_enabled:e=>"JupyterLab Classic"!=e.app.name,label:e.__("Show diagnostics panel"),rank:3,icon:Lt}],Wt={id:qt,requires:[r,x.ISettingRegistry,C.ITranslator],autoStart:!0,activate:(e,t,n,i)=>{const s=new Je(n,qt),o=i.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",Ft]]),id:qt,capabilities:{textDocument:{publishDiagnostics:{tagSupport:{valueSet:[Fe.Deprecated,Fe.Unnecessary]}}}},name:"LSP Diagnostics",settings:s,commands:Ht(o)}})}};var Nt=n(7458);const Ut=new _e.LabIcon({name:"lsp:highlight",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M18.5 1.15c-.53 0-1.04.19-1.43.58l-5.81 5.82 5.65 5.65 5.82-5.81c.77-.78.77-2.04 0-2.83l-2.84-2.83c-.39-.39-.89-.58-1.39-.58M10.3 8.5l-5.96 5.96c-.78.78-.78 2.04.02 2.85C3.14 18.54 1.9 19.77.67 21h5.66l.86-.86c.78.76 2.03.75 2.81-.02l5.95-5.96"/>\n  </g>\n</svg>\n'}),Vt=new _e.LabIcon({name:"lsp:highlight-type",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M18.5 1.15c-.53 0-1.04.19-1.43.58l-5.81 5.82 5.65 5.65 5.82-5.81c.77-.78.77-2.04 0-2.83l-2.84-2.83c-.39-.39-.89-.58-1.39-.58M10.3 8.5l-5.96 5.96c-.78.78-.78 2.04.02 2.85C3.14 18.54 1.9 19.77.67 21h5.66l.86-.86c.78.76 2.03.75 2.81-.02l5.95-5.96M18 16v2h2v8h2v-8h2v-2h-6z"/>\n  </g>\n</svg>\n'}),Bt=e=>[{id:"highlight-references",execute:({connection:e,virtual_position:t,document:n})=>null==e?void 0:e.getReferences(t,n.document_info),is_enabled:({connection:e})=>!!e&&e.isReferencesSupported(),label:e.__("Highlight references"),icon:Ut},{id:"highlight-type-definition",execute:({connection:e,virtual_position:t,document:n})=>null==e?void 0:e.getTypeDefinition(t,n.document_info),is_enabled:({connection:e})=>!!e&&e.isTypeDefinitionSupported(),label:e.__("Highlight type definition"),icon:Vt}];class Kt extends Xe{constructor(){super(...arguments),this.highlight_markers=[],this.last_token=null,this.onBlur=()=>{this.settings.composite.removeOnBlur?(this.clear_markers(),this.last_token=null):this.onCursorActivity().catch(console.warn)},this.handleHighlight=e=>{if(this.clear_markers(),e)for(let t of e){let e=this.range_to_editor_range(t.range),n=t.kind?"cm-lsp-highlight-"+We[t.kind]:"",i=this.highlight_range(e,"cm-lsp-highlight "+n);this.highlight_markers.push(i)}},this.on_cursor_activity=async()=>(this.sent_version=this.virtual_document.document_info.version,await this.connection.getDocumentHighlights(this.virtual_position,this.virtual_document.document_info,!1)),this.onCursorActivity=async()=>{var e,t;if(!(null===(t=null===(e=this.virtual_editor)||void 0===e?void 0:e.virtual_document)||void 0===t?void 0:t.document_info))return;let n;await this.virtual_editor.virtual_document.update_manager.update_done;try{n=this.virtual_editor.getDoc().getCursor("start")}catch(e){return void this.console.warn("no root position available")}if(null==n)return void this.console.warn("no root position available");const i=this.virtual_editor.get_token_at(n);if(this.last_token&&i.value===this.last_token.value&&""!==i.value)return void this.console.log("not requesting highlights (token did not change)",i);let s;try{s=this.virtual_editor.document_at_root_position(n)}catch(e){return void this.console.warn("Could not obtain virtual document from position",n)}if(s===this.virtual_document)try{let e=this.virtual_editor.root_position_to_virtual_position(n);this.virtual_position=e,Promise.all([this.debounced_get_highlight.invoke(),async()=>{this.clear_markers(),this.last_token=null}]).then((([t])=>{if(this.virtual_document.isDisposed)return;let n=this.virtual_document.document_info.version;n===this.sent_version?e===this.virtual_position?(this.handleHighlight(t),this.last_token=i):this.console.log("skipping highlights response: cursor moved since it was requested"):this.console.log("skipping highlights response delayed by "+(n-this.sent_version)+" document versions")})).catch(this.console.warn)}catch(e){this.console.warn("Could not get highlights:",e)}}}get settings(){return super.settings}register(){this.debounced_get_highlight=this.create_debouncer(),this.settings.changed.connect((()=>{this.debounced_get_highlight=this.create_debouncer()})),this.editor_handlers.set("cursorActivity",this.onCursorActivity),this.editor_handlers.set("blur",this.onBlur),this.editor_handlers.set("focus",this.onCursorActivity),super.register()}remove(){this.clear_markers(),super.remove()}clear_markers(){for(let e of this.highlight_markers)e.clear();this.highlight_markers=[]}create_debouncer(){return new Nt.dx(this.on_cursor_activity,this.settings.composite.debouncerDelay)}}const Zt=o+":highlights",Jt={id:Zt,requires:[r,x.ISettingRegistry,C.ITranslator],autoStart:!0,activate:(e,t,n,i)=>{const s=new Je(n,Zt),o=i.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",Kt]]),id:Zt,name:"LSP Highlights",settings:s,commands:Bt(o)}})}};var Gt=n(1063);class Xt extends Gt.Tooltip{constructor(e){super(e),this.options=e,this._setGeometry();const t=new Ke.MimeModel({data:e.bundle});this._content.renderModel(t).then((()=>this._setGeometry())).catch(console.warn)}handleEvent(e){if(this.isHidden||this.isDisposed)return;const{node:t}=this,n=e.target;switch(e.type){case"keydown":{const i=e.keyCode;if(t.contains(n)||!this.options.hideOnKeyPress&&27!=i&&8!=i)return;this.dispose();break}default:super.handleEvent(e)}}_setGeometry(){const e=this._editor,t=null==this.options.position?e.getCursorPosition():this.options.position,n=e.getOffsetAt(t),i=e.getLine(t.line);if(!i)return;let s;switch(this.options.alignment){case"start":{const t=i.substring(0,n).split(/\W+/),o=t[t.length-1],r=o?n-o.length:n;s=e.getPositionAt(r);break}case"end":{const t=i.substring(0,n).split(/\W+/),o=t[t.length-1],r=o?n-o.length:n;s=e.getPositionAt(r);break}default:s=t}if(!s)return;const o=e.getCoordinateForPosition(s),r=window.getComputedStyle(this.node),a=parseInt(r.paddingLeft,10)||0;w.HoverBox.setGeometry({anchor:o,host:e.host,maxHeight:250,minHeight:20,node:this.node,offset:{horizontal:-1*a},privilege:this.options.privilege||"below",style:r})}}class Yt{constructor(e){this.rendermime_registry=e,this.currentTooltip=null}create(e){this.remove(),this.currentOptions=e;let{markup:t,position:n,adapter:i}=e,s=i.widget;const o="plaintext"===t.kind?{"text/plain":t.value}:{"text/markdown":t.value},r=new Xt(Object.assign(Object.assign({},e.tooltip||{}),{anchor:s.content,bundle:o,editor:e.ce_editor,rendermime:this.rendermime_registry,position:A.cm_to_ce(n)}));return r.addClass("lsp-tooltip"),e.className&&r.addClass(e.className),_t.Widget.attach(r,document.body),this.currentTooltip=r,r}get position(){return this.currentOptions.position}isShown(e){var t;return(!e||!this.currentOptions||(null===(t=this.currentOptions)||void 0===t?void 0:t.id)===e)&&null!==this.currentTooltip&&!this.currentTooltip.isDisposed&&this.currentTooltip.isVisible}remove(){null!==this.currentTooltip&&(this.currentTooltip.dispose(),this.currentTooltip=null)}}new _e.LabIcon({name:"lsp:hover",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M11 18h2v-2h-2v2m1-12a4 4 0 00-4 4h2a2 2 0 012-2 2 2 0 012 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5a4 4 0 00-4-4M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"/>\n  </g>\n</svg>\n'});class Qt{constructor(e){this.maxSize=e,this._data=[]}get data(){return this._data}store(e){const t=this._data.findIndex((t=>t.document===e.document&&h(t.editor_range.start,e.editor_range.start)&&h(t.editor_range.end,e.editor_range.end)&&t.editor_range.editor===e.editor_range.editor));-1===t?(this._data.length>=this.maxSize&&this._data.shift(),this._data.push(e)):this._data[t]=e}clean(){this._data=[]}}function en(e){return"string"==typeof e?{kind:"markdown",value:e}:{kind:"markdown",value:"```"+e.language+"\n"+e.value+"\n```"}}class tn extends Xe{constructor(e){super(e),this.last_hover_character=null,this.hover_marker=null,this._previousHoverRequest=null,this.onKeyDown=e=>{if((0,$.nE)(e,this.modifierKey)&&null!==this.last_hover_character){if(this.tooltip&&this.tooltip.isVisible&&!this.tooltip.isDisposed)return;const t=this.virtual_editor.document_at_root_position(this.last_hover_character);let n=this.restore_from_cache(t,this.virtual_position);if(null==n)return;e.stopPropagation(),this.handleResponse(n,this.last_hover_character,!0)}},this.onMouseLeave=e=>{this.remove_range_highlight(),this.maybeHideTooltip(e)},this.on_hover=async()=>{var e;if(!this.connection.isReady||!(null===(e=this.connection.serverCapabilities)||void 0===e?void 0:e.hoverProvider))return;let t=this.virtual_position;return await this.connection.clientRequests["textDocument/hover"].request({textDocument:{uri:this.virtual_document.document_info.uri},position:{line:t.line,character:t.ch}})},this.handleResponse=(e,t,n)=>{let i=e.response;if(this.last_hover_response!=i&&(this.remove_range_highlight(),this.hover_marker=this.highlight_range(e.editor_range,"cm-lsp-hover-available")),this.last_hover_response=i,n){this.lab_integration.tooltip.remove();const n=tn.get_markup_for_hover(i);let s=this.virtual_editor.root_position_to_editor(t);return this.tooltip=this.lab_integration.tooltip.create({markup:n,position:s,ce_editor:e.ce_editor,adapter:this.adapter,className:"lsp-hover"}),!0}return!1},this.updateUnderlineAndTooltip=e=>{try{return this._updateUnderlineAndTooltip(e)}catch(e){return void("Cell not found in cell_line_map"!==e.message&&"Cannot read property 'string' of undefined"!==e.message&&this.console.warn(e))}},this.remove_range_highlight=()=>{this.hover_marker&&(this.hover_marker.clear(),this.hover_marker=null,this.last_hover_response=null,this.last_hover_character=null)}}get modifierKey(){return this.settings.composite.modifierKey}get lab_integration(){return super.lab_integration}get settings(){return super.settings}restore_from_cache(e,t){const{line:n,ch:i}=t,s=this.cache.data.filter((t=>{if(t.document!==e)return!1;let s=t.response.range;return n>=s.start.line&&n<=s.end.line&&(n!=s.start.line||i>s.start.character)&&(n!=s.end.line||i<=s.end.character)}));return s.length>1&&this.console.warn("Potential hover cache malfunction: ",t,s),0!=s.length?s[0]:null}register(){this.cache=new Qt(this.settings.composite.cacheSize),this.wrapper_handlers.set("mousemove",(e=>{var t;null===(t=this.updateUnderlineAndTooltip(e))||void 0===t||t.then((t=>{t||this.maybeHideTooltip(e)})).catch(this.console.warn)})),this.wrapper_handlers.set("mouseleave",this.onMouseLeave),this.wrapper_handlers.set("keydown",this.onKeyDown),this.editor_handlers.set("keydown",((e,t)=>this.onKeyDown(t))),this.debounced_get_hover=this.create_throttler(),this.settings.changed.connect((()=>{this.cache.maxSize=this.settings.composite.cacheSize,this.debounced_get_hover=this.create_throttler()})),super.register()}maybeHideTooltip(e){void 0===this.tooltip||function(e,t,n=50){const i="mouseleave"===t.type?t.relatedTarget:t.target;if(e===i||e.contains(i))return!0;const s=e.getBoundingClientRect();return!(t.x<s.left-n||t.x>s.right+n||t.y<s.top-n||t.y>s.bottom+n)}(this.tooltip.node,e)||this.tooltip.dispose()}create_throttler(){return new Nt.eD(this.on_hover,{limit:this.settings.composite.throttlerDelay,edge:"trailing"})}afterChange(e,t){super.afterChange(e,t),this.cache.clean(),this.last_hover_character=null,this.remove_range_highlight()}static get_markup_for_hover(e){let t=e.contents;if("string"==typeof t&&(t=[t]),!Array.isArray(t))return t;let n=t.map(en);return n.every((e=>"plaintext"==e.kind))?{kind:"plaintext",value:n.map((e=>e.value)).join("\n")}:{kind:"markdown",value:n.map((e=>e.value)).join("\n\n")}}is_token_empty(e){return 0===e.string.length}is_event_inside_visible(e){return null!=e.target.closest(".CodeMirror-sizer")}is_useful_response(e){return e&&e.contents&&!(Array.isArray(e.contents)&&0===e.contents.length)}async _updateUnderlineAndTooltip(e){if(e.target.classList.contains("CodeMirror-line"))return this.remove_range_highlight(),!1;const t=(0,$.nE)(e,this.modifierKey);let n=this.position_from_mouse(e);if(null==n)return this.remove_range_highlight(),!1;let i=this.virtual_editor.getTokenAt(n),s=this.virtual_editor.document_at_root_position(n);if(this.is_token_empty(i)||s!==this.virtual_document||!this.is_event_inside_visible(e))return this.remove_range_highlight(),!1;if(this.last_hover_character&&h(n,this.last_hover_character))return!0;{let e=this.virtual_editor.root_position_to_virtual_position(n);this.virtual_position=e,this.last_hover_character=n,this._previousHoverRequest&&await Promise.race([this._previousHoverRequest,new Promise((e=>setTimeout(e,1e3)))]);let o=this.restore_from_cache(s,e);if(null==o){const e=this.debounced_get_hover.invoke();this._previousHoverRequest=e;let t=await e;if(this._previousHoverRequest===e&&(this._previousHoverRequest=null),!t||!this.is_useful_response(t))return this.remove_range_highlight(),!1;{let e=this.virtual_editor.get_editor_at_root_position(n),r=this.virtual_editor.ce_editor_to_cm_editor.get(e),a=this.get_editor_range(t,n,i,r);o={response:this.add_range_if_needed(t,a,e),document:s,editor_range:a,ce_editor:e},this.cache.store(o)}}return this.handleResponse(o,n,t)}}remove(){this.cache.clean(),this.remove_range_highlight(),this.debounced_get_hover.dispose(),super.remove()}get_editor_range(e,t,n,i){if(void 0!==e.range)return this.range_to_editor_range(e.range,i);let s={line:t.line,ch:n.start},o={line:t.line,ch:n.end};return{start:this.virtual_editor.root_position_to_editor(s),end:this.virtual_editor.root_position_to_editor(o),editor:i}}add_range_if_needed(e,t,n){return void 0!==e.range?e:Object.assign(Object.assign({},e),{range:{start:A.cm_to_lsp(this.virtual_editor.root_position_to_virtual_position(this.virtual_editor.transform_from_editor_to_root(n,t.start))),end:A.cm_to_lsp(this.virtual_editor.root_position_to_virtual_position(this.virtual_editor.transform_from_editor_to_root(n,t.end)))}})}}class nn{constructor(e,t,n){this.tooltip=new Yt(n)}}const sn=o+":hover",on={id:sn,requires:[r,x.ISettingRegistry,Ke.IRenderMimeRegistry],autoStart:!0,activate:(e,t,n,i)=>{const s=new Je(n,sn),o=new nn(e,s,i);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",tn]]),id:sn,name:"LSP Hover tooltip",labIntegration:o,settings:s,capabilities:{textDocument:{hover:{dynamicRegistration:!0,contentFormat:["markdown","plaintext"]}}}}})}},rn=new _e.LabIcon({name:"lsp:rename",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M17 7h5v10h-5v2a1 1 0 001 1h2v2h-2.5c-.55 0-1.5-.45-1.5-1 0 .55-.95 1-1.5 1H12v-2h2a1 1 0 001-1V5a1 1 0 00-1-1h-2V2h2.5c.55 0 1.5.45 1.5 1 0-.55.95-1 1.5-1H20v2h-2a1 1 0 00-1 1v2M2 7h11v2H4v6h9v2H2V7m18 8V9h-3v6h3z"/>\n  </g>\n</svg>\n'}),an=o+":rename",ln=e=>[{id:"rename-symbol",execute:async({editor:t,connection:n,virtual_position:i,document:s,features:o})=>{const r=o.get(an);r.setTrans(e);let a=r.transform_virtual_position_to_root_position(i),l=t.get_token_at(a).value,c=n=>{let i="";if(o.has(qt)){let e=o.get(qt);i=cn.ux_workaround_for_rope_limitation(n,e,t,r)}i||(i=e.__("Rename failed: %1",n)),r.setStatus(i,7500)};const d=await w.InputDialog.getText({title:e.__("Rename to"),text:l,okLabel:e.__("Rename"),cancelLabel:e.__("Cancel")});try{const t=d.value;if(1!=d.button.accept||null==t)return;r.setStatus(e.__("Renaming %1 to %2...",l,t),2e3);const o=await(null==n?void 0:n.rename(i,s.document_info,t,!1));o?await r.handleRename(o,l,t):c(new Error("no edit from server"))}catch(e){c(e)}},is_enabled:({connection:e})=>!!e&&e.provides("renameProvider"),label:e.__("Rename symbol"),icon:rn}];class cn extends Xe{setTrans(e){this.trans=e}setStatus(e,t){return this.status_message.set(e,t)}async handleRename(e,t,n){let i;try{i=await this.apply_edit(e)}catch(e){return void this.status_message.set(this.trans.__("Rename failed: %1",e))}try{let e;const s=this.trans.__("%1 to %2",t,n);e=0===i.appliedChanges?this.trans.__("Could not rename %1 - consult the language server documentation",s):i.wasGranular?this.trans._n("Renamed %2 in %3 place","Renamed %2 in %3 places",i.appliedChanges,s,i.appliedChanges):this.adapter.has_multiple_editors?this.trans._n("Renamed %2 in %3 cell","Renamed %2 in %3 cells",i.modifiedCells,s,i.modifiedCells):this.trans.__("Renamed %1",s),0!==i.errors.length&&(e+=this.trans.__(" with errors: %1",i.errors)),this.status_message.set(e,5e3)}catch(e){this.console.warn(e)}return i}static ux_workaround_for_rope_limitation(e,t,n,i){let s=!1;try{s=e.message.includes("IndexError")}catch(e){return null}if(!s)return null;let o=(t.diagnostics_db.all||[]).filter((e=>e.diagnostic.message.includes("invalid syntax")||e.diagnostic.message.includes("SyntaxError")||e.diagnostic.message.includes("IndentationError")));if(0===o.length)return null;let r=[...new Set(o.map((e=>{let t=e.diagnostic.message,s=e.range.start;if(i.adapter.has_multiple_editors){let{index:o}=n.find_editor(e.editor),r=o+1;return i.trans.__("%1 in cell %2 at line %3",t,r,s.line)}return i.trans.__("%1 at line %2",t,s.line)})))].join(", ");return i.trans.__("Syntax error(s) prevent rename: %1",r)}}const dn={id:an,requires:[r,x.ISettingRegistry,C.ITranslator],autoStart:!0,activate:(e,t,n,i)=>{const s=(i||C.nullTranslator).load("jupyterlab_lsp"),o=new Je(n,an);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",cn]]),id:an,name:"LSP Rename",settings:o,commands:ln(s)}})}},hn="signature";function un(e){return"string"==typeof e?(0,$.ry)(e):"markdown"===e.kind?e.value:(0,$.ry)(e.value)}class _n extends Xe{get settings(){return super.settings}get _closeCharacters(){return this.settings?this.settings.composite.closeCharacters:[]}register(){this.editor_handlers.set("cursorActivity",this.onCursorActivity.bind(this)),this.editor_handlers.set("blur",this.onBlur.bind(this)),this.editor_handlers.set("focus",this.onCursorActivity.bind(this)),super.register()}onBlur(e,t){this.isSignatureShown()&&null===t.relatedTarget.closest(".lsp-signature-help")&&this._hideTooltip()}onCursorActivity(){var e;if(!this.isSignatureShown())return;const t=this.virtual_editor.get_cursor_position(),n=this.lab_integration.tooltip.position;let i=this.virtual_editor.root_position_to_editor(t);i.line===n.line&&i.ch<n.ch?this._hideTooltip():null===(e=this.requestSignature(t,n))||void 0===e||e.catch(this.console.warn)}get lab_integration(){return super.lab_integration}get_markup_for_signature_help(e,t=""){let n=new Array;if(null!=e.activeSignature){if(!(e.activeSignature>=e.signatures.length)){const n=e.signatures[e.activeSignature];return{kind:"markdown",value:this.signatureToMarkdown(n,t,e.activeParameter)}}this.console.error("LSP server returned wrong number for activeSignature for: ",e)}return e.signatures.forEach((e=>{let i=this.signatureToMarkdown(e,t);n.push(i)})),{kind:"markdown",value:n.join("\n\n")}}highlightCode(e,t,n){const i=document.createElement("pre"),s=document.createElement("code");return i.appendChild(s),s.className=`cm-s-jupyter language-${n}`,this.lab_integration.codeMirror.CodeMirror.runMode(e,n,((e,n)=>{let i;if(n?(i=document.createElement("span"),i.classList.add("cm-"+n),i.textContent=e):i=document.createTextNode(e),"variable"===n&&e===t){const e=document.createElement("mark");e.appendChild(i),i=e}s.appendChild(i)})),i.outerHTML}signatureToMarkdown(e,t,n){return function(e,t="",n,i,s,o=4){const r=void 0!==e.activeParameter?e.activeParameter:s;let a,l=e.label;if(e.parameters&&null!=r)if(r>e.parameters.length)i.error("LSP server returned wrong number for activeSignature for: ",e),a="```"+t+"\n"+l+"\n```";else{const i=e.parameters[r];let s="string"==typeof i.label?i.label:l.slice(i.label[0],i.label[1]);a=n(l,s,t)}else a="```"+t+"\n"+l+"\n```";let c="";if(e.documentation)if("string"==typeof e.documentation||"plaintext"===e.documentation.kind){const t="string"==typeof e.documentation?e.documentation:e.documentation.value;for(let n of t.split("\n"))n.trim()!==e.label.trim()&&(c+=un(n)+"\n")}else"markdown"!==e.documentation.kind&&i.warn("Unknown MarkupContent kind:",e.documentation.kind),c+=e.documentation.value;else e.parameters&&(c+="\n\n"+e.parameters.filter((e=>e.documentation)).map((e=>"- "+un(e.documentation))).join("\n"));if(c){const e=c.trim().split("\n");if(e.length>o){const t=function(e,t){const n=[];let i=!1;for(const s of e.slice(0,t+1)){if(""==s.trim()){i=!0;break}n.push(s)}const s=n.join("\n");return i&&-1===s.search(/[\\*#[\]<>_]/g)?{lead:s,remainder:e.slice(n.length+1).join("\n")}:null}(e,o);c=t?t.lead+"\n<details>\n"+t.remainder+"\n</details>":"<details>\n"+c+"\n</details>"}a+="\n\n"+c}else a+="\n";return a}(e,t,this.highlightCode.bind(this),this.console,n,this.settings.composite.maxLines)}_hideTooltip(){this.lab_integration.tooltip.remove()}handleSignature(e,t,n=null){if(this.console.log("Signature received",e),(e||null===e)&&this._hideTooltip(),!this.signatureCharacter||!e||!e.signatures.length)return void this.console.debug("Ignoring signature response: cursor lost or response empty");let i=this.virtual_editor.get_cursor_position();(t.line!=i.line||i.ch<t.ch)&&this.console.debug("Ignoring signature response: cursor has receded or changed line");let s=this.get_cm_editor(i);if(!s.hasFocus())return void this.console.debug("Ignoring signature response: the corresponding editor lost focus");let o=this.virtual_editor.root_position_to_editor(i),r=this.get_language_at(o,s),a=this.get_markup_for_signature_help(e,r);this.console.log("Signature will be shown",r,a,i,e),this.lab_integration.tooltip.create({markup:a,position:null===n?o:n,id:hn,ce_editor:this.virtual_editor.find_ce_editor(s),adapter:this.adapter,className:"lsp-signature-help",tooltip:{privilege:"forceAbove",alignment:"start",hideOnKeyPress:!1}})}get signatureCharacters(){var e;return(null===(e=this._signatureCharacters)||void 0===e?void 0:e.length)||(this._signatureCharacters=this.connection.getLanguageSignatureCharacters()),this._signatureCharacters}isSignatureShown(){return this.lab_integration.tooltip.isShown(hn)}afterChange(e,t){var n;let i=this.extract_last_character(e);const s=this.isSignatureShown();let o=null;s&&(o=this.lab_integration.tooltip.position,this._closeCharacters.includes(i)&&this._hideTooltip()),(this.signatureCharacters.includes(i)||s)&&(null===(n=this.requestSignature(t,o))||void 0===n||n.catch(this.console.warn))}requestSignature(e,t){var n;if(!this.connection.isReady||!(null===(n=this.connection.serverCapabilities)||void 0===n?void 0:n.signatureHelpProvider))return;this.signatureCharacter=e;let i=this.virtual_editor.root_position_to_virtual_position(e);return this.connection.clientRequests["textDocument/signatureHelp"].request({position:{line:i.line,character:i.ch},textDocument:{uri:this.virtual_document.document_info.uri}}).then((n=>this.handleSignature(n,e,t)))}}class gn{constructor(e,t,n,i){this.codeMirror=i,this.tooltip=new Yt(n)}}const pn=o+":signature",mn={id:pn,requires:[r,x.ISettingRegistry,Ke.IRenderMimeRegistry,gt.ICodeMirror],autoStart:!0,activate:(e,t,n,i,s)=>{const o=new Je(n,pn),r=new gn(e,o,i,s);t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",_n]]),id:pn,name:"LSP Function signature",labIntegration:r,settings:o,capabilities:{textDocument:{signatureHelp:{dynamicRegistration:!0,signatureInformation:{documentationFormat:["markdown","plaintext"]}}}}}})}};var fn=n(5307);new _e.LabIcon({name:"lsp:syntax-highlighting",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24">\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161" shape-rendering="geometricPrecision">\n    <path d="M10.48 10.88l3.68-3.68-3.68-3.68L11.6 2.4l4.8 4.8-4.8 4.8-1.12-1.12m-4.16 0L2.64 7.2l3.68-3.68L5.2 2.4.4 7.2 5.2 12l1.12-1.12zM8.5 23.8l2.337-2.338-.025-.017a1.283 1.283 0 010-1.802l4.029-4.029 3.604 3.604-4.029 4.03a1.267 1.267 0 01-1.776.017l-.536.535H8.5m10.124-11.976a1.283 1.283 0 011.802 0l1.81 1.802a1.293 1.293 0 010 1.81l-2.805 2.796-3.604-3.604 2.797-2.805z"/>\n  </g>\n</svg>\n'});const vn=o+":syntax_highlighting";class wn extends Xe{constructor(e){super(e),this.virtual_document.changed.connect(this.update_mode.bind(this),this),this.editors_with_active_highlight=new Set}get lab_integration(){return super.lab_integration}get settings(){return super.settings}get_mode(e){let t=this.lab_integration.mimeTypeService.getMimeTypeByLanguage({name:e});if(t&&"text/plain"!=t)return this.lab_integration.codeMirror.CodeMirror.findModeByMIME(t)}update_mode(){let e=this.virtual_document,t=new Set;for(let n of e.foreign_document_maps)for(let[e,i]of n.entries()){let n=i.editor,s=n.editor,o=s.getValue("\n").concat("").length,r=(n.getOffsetAt(e.end)-n.getOffsetAt(e.start))/o,a=i.virtual_document.language,l=this.get_mode(a);void 0!==l&&r>this.settings.composite.foreignCodeThreshold&&(t.add(n),s.getOption("mode")!=l.mime&&s.setOption("mode",l.mime))}if(t!=this.editors_with_active_highlight)for(let e of this.editors_with_active_highlight)t.has(e)||e.editor.setOption("mode",e.model.mimeType);this.editors_with_active_highlight=t}}class yn{constructor(e,t){this.mimeTypeService=e,this.codeMirror=t}}const bn={id:vn,requires:[r,fn.IEditorServices,x.ISettingRegistry,gt.ICodeMirror,C.ITranslator],autoStart:!0,activate:(e,t,n,i,s,o)=>{const r=new Je(i,vn),a=o.load("jupyterlab_lsp");t.register({feature:{editorIntegrationFactory:new Map([["CodeMirrorEditor",wn]]),commands:[],id:vn,name:a.__("Syntax highlighting"),labIntegration:new yn(n.mimeTypeService,s),settings:r}})}};var xn=n(2978);class kn{constructor(e){this._sessionsChanged=new j.Signal(this),this._sessions=new Map,this._specs=new Map,this._warningsEmitted=new Set,this._settings=e.settings||xn.ServerConnection.makeSettings(),this._baseUrl=e.baseUrl||z.PageConfig.getBaseUrl(),this._retries=e.retries||2,this._retriesInterval=e.retriesInterval||1e4,this._statusCode=-1,this._configuration={},this.console=e.console,this.fetchSessions().catch(console.warn)}get specs(){return this._specs}get statusUrl(){return z.URLExt.join(this._baseUrl,i.URL_NS,"status")}get sessionsChanged(){return this._sessionsChanged}get sessions(){return this._sessions}setConfiguration(e){this._configuration=e}warnOnce(e){this._warningsEmitted.has(e)||(this._warningsEmitted.add(e),this.console.warn(e))}_comparePriorities(e,t){var n,i,s,o;const r=null!==(i=null===(n=this._configuration[e])||void 0===n?void 0:n.priority)&&void 0!==i?i:50,a=null!==(o=null===(s=this._configuration[t])||void 0===s?void 0:s.priority)&&void 0!==o?o:50;return r==a?(this.warnOnce(`Two matching servers: ${e} and ${t} have the same priority; choose which one to use by changing the priority in Advanced Settings Editor`),e.localeCompare(t)):a-r}isMatchingSpec(e,t){const n=e.language.toLocaleLowerCase();return t.languages.some((e=>e.toLocaleLowerCase()==n))}getMatchingServers(e){if(!e.language)return this.console.error("Cannot match server by language: language not available; ensure that kernel and specs provide language and MIME type"),[];const t=[];for(const[n,i]of this._sessions.entries())this.isMatchingSpec(e,i.spec)&&t.push(n);return t.sort(this._comparePriorities.bind(this))}getMatchingSpecs(e){const t=new Map;for(const[n,i]of this._specs.entries())this.isMatchingSpec(e,i)&&t.set(n,i);return t}get statusCode(){return this._statusCode}async fetchSessions(){let e,t=await xn.ServerConnection.makeRequest(this.statusUrl,{method:"GET"},this._settings);if(this._statusCode=t.status,!t.ok)return console.error("Could not fetch sessions",t),void(this._retries>0&&(this._retries-=1,setTimeout(this.fetchSessions.bind(this),this._retriesInterval)));try{const n=await t.json();e=n.sessions;try{this._version=n.version,this._specs=new Map(Object.entries(n.specs))}catch(e){console.warn(e)}}catch(e){return void console.warn(e)}for(let t of Object.keys(e)){let n=t;this._sessions.has(n)?Object.assign(this._sessions.get(n),e[t]):this._sessions.set(n,e[t])}const n=this._sessions.keys();for(const t in n)if(!e[t]){let e=t;this._sessions.delete(e)}this._sessionsChanged.emit(void 0)}}class Cn{constructor(){this._overrides={}}get registry(){return this._overrides}register(e,t){t in this._overrides||(this._overrides[t]={cell:[],line:[]});let n=this._overrides[t];switch(e.scope){case"cell":n.cell.push(e);break;case"line":n.line.push(e)}}}const Sn={id:f.name,requires:[],activate:e=>new Cn,provides:f,autoStart:!0};let Mn={python:[new m({language:"python",pattern:"^%%(python|python2|python3|pypy)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!0,file_extension:"py"}),new m({language:"perl",pattern:"^%%(perl)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!0,file_extension:"pl"}),new m({language:"ruby",pattern:"^%%(ruby)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!0,file_extension:"rb"}),new m({language:"sh",pattern:"^%%(sh|bash)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!0,file_extension:"sh"}),new m({language:"html",pattern:"^%%(html --isolated)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!0,file_extension:"html"}),new m({language:"javascript",pattern:"^%%(js|javascript)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!1,file_extension:"js"}),new m({language:"html",pattern:"^%%(?!html --isolated)(html)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!1,file_extension:"html"}),new m({language:"latex",pattern:"^%%(latex)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!1,file_extension:"tex"}),new m({language:"markdown",pattern:"^%%(markdown)( .*?)?\n([^]*)",foreign_capture_groups:[3],is_standalone:!1,file_extension:"md"})]};function En(e){return e.replace(/\\([\\"])/g,"$1")}function jn(e){return e?function(e){return e.replace(/(["\\])/g,"\\$1")}(e):""}const In="^(\\s*|\\s*\\S+\\s*=\\s*)";let Tn=[{pattern:In+"!([^=\\s]+)(.*)(\n)?",replacement:'$1get_ipython().getoutput("$2$3")$4',scope:"line",reverse:{pattern:'get_ipython\\(\\).getoutput\\("(.*?)"\\)(\n)?',replacement:"!$1$2",scope:"line"}},{pattern:"^(\\s*)(\\?{1,2})([^?\\s'\"\\(\\)-\\+\\/#]+)(\n)?$",replacement:(e,t,n,i,s)=>`${t}get_ipython().run_line_magic('${"?"==n?"pinfo":"pinfo2"}', '${i}')${s=s||""}`,scope:"line",reverse:{pattern:"get_ipython\\(\\).run_line_magic\\('(pinfo2?)', '(.*?)'\\)(\n)?",replacement:(e,t,n)=>`${"pinfo"==t?"?":"??"}${n}`,scope:"line"}},{pattern:"^(\\s*)([^?\\s'\"\\(\\)-\\+\\/#]+)(\\?{1,2})(\n)?",replacement:(e,t,n,i,s)=>`${t}get_ipython().run_line_magic('${"?"==i?"pinfo":"pinfo2"}',  '${n}')${s=s||""}`,scope:"line",reverse:{pattern:"get_ipython\\(\\).run_line_magic\\('(pinfo2?)',  '(.*?)'\\)(\n)?",replacement:(e,t,n)=>`${n}${"pinfo"==t?"?":"??"}`,scope:"line"}},{pattern:In+"%(\\S+)(.*)(\n)?",replacement:(e,t,n,i,s)=>`${t}get_ipython().run_line_magic("${n}", "${i=jn(i)}")${s=s||""}`,scope:"line",reverse:{pattern:'get_ipython\\(\\).run_line_magic\\("(.*?)", "(.*?)"\\)(\n)?',replacement:(e,t,n)=>`%${t}${n=En(n)}`,scope:"line"}},{pattern:"^%%(\\S+)(.*\n)([\\s\\S]*)",replacement:(e,t,n,i,s,o)=>((n=jn(n))&&(n=n.slice(0,-1)),`get_ipython().run_cell_magic("${t}", "${n}", """${i=i.replace(/"""/g,'\\"\\"\\"')}""")`),scope:"cell",reverse:{pattern:'^get_ipython\\(\\).run_cell_magic\\("(.*?)", "(.*?)", """([\\s\\S]*)"""\\)',replacement:(e,t,n,i)=>(i=i.replace(/\\"\\"\\"/g,'"""'),`%%${t}${n=En(n)}\n${i}`),scope:"cell"}}];const Ln={id:o+":ipython",requires:[c,f],activate:(e,t,n)=>{for(let e of Object.keys(Mn))for(let n of Mn[e])t.register(n,e);for(let e of Tn)n.register(e,"python")},autoStart:!0},Rn="(?:"+["-l","--connections"].join("|")+"|"+["--destination_table","--project","--use_bqstorage_api","--use_rest_api","--use_legacy_sql","--verbose","--params"].map((e=>e+" \\w+")).join("|")+")";let Dn={python:[new m({language:"sql",pattern:`^%%bigquery(?: (?:(?:(?:.*?)://(?:.*))|${Rn}|(?:\\w+ << )|(?:\\w+@\\w+)))?\n?((?:.+\n)?(?:[^]*))`,foreign_capture_groups:[1],is_standalone:!0,file_extension:"sql"})]};const Pn={id:o+":ipython-bigquery",requires:[c],activate:(e,t)=>{for(let e of Object.keys(Dn))for(let n of Dn[e])t.register(n,e)},autoStart:!0};function An(e,t){let n=[],i=[],s=[];for(let t=0;t<e.length;t+=2){let o=e[t],r=e[t+1];if(null==o)break;"i"===o||"-input"===o?n.push(r):"o"===o||"-output"===o?i.push(r):s.push("-"+o+" "+r)}return{inputs:n,outputs:i,rest:e[e.length+t],others:s}}function On(e,t){let{inputs:n,outputs:i,rest:s,others:o}=An(e,t),r=n.join(", ");r&&(r=", "+r);let a=i.join(", ");return a&&(a+=" = "),{content:s,others:o.join(" "),inputs:r,outputs:a}}function zn(e='"',t=!1,n="R"){return"(\\S+)?"+"(?:, (\\S+))?".repeat(9)+"( = )?rpy2\\.ipython\\.rmagic\\.RMagics."+n+"\\("+e+(t?"([\\s\\S]*)":"(.*?)")+e+', "(.*?)"'+"(?:, (\\S+))?".repeat(10)+"\\)"}function $n(e,...t){let n=[];for(let e=0;e<10&&null!=t[e];e++)n.push(t[e]);let i=[];for(let e=13;e<23&&null!=t[e];e++)i.push(t[e]);let s=i.join(" -i ");s&&(s=" -i "+s);let o=n.join(" -o ");o&&(o=" -o "+o);let r=t[11],a=t[12];return a&&(a=" "+a),{input:s,output:o,other:a,contents:r}}function Fn(e){return"(?: -(\\S+) (\\S+))?".repeat(e)}function qn(e){return function(t,...n){let i,s=An(n,-3);return i=null==s.rest?"":e&&s.rest.startsWith(" ")?s.rest.slice(1):s.rest,i}}let Hn=qn(!1);function Wn(e,...t){let n=An(t,-3).inputs.map((e=>e+" <- data.frame();")).join(" "),i=Hn(e,...t);return""!==n&&i&&(n+=" "),n}let Nn={python:[new m({language:"r",pattern:"^%%R"+Fn(10)+"\n([^]*)",foreign_capture_groups:[21],foreign_replacer:Hn,extract_arguments:Wn,is_standalone:!1,file_extension:"R"}),new m({language:"r",pattern:"(?:^|\n)%R"+Fn(10)+"(?: (.*))?(?:\n|$)",foreign_capture_groups:[21],foreign_replacer:qn(!0),extract_arguments:Wn,is_standalone:!1,file_extension:"R"})]},Un=[{pattern:In+"%R"+Fn(10)+"( .*)?(\n|$)",replacement:(e,t,...n)=>{let i=On(n,-4);return`${t}${i.outputs}rpy2.ipython.rmagic.RMagics.R("${i.content||""}", "${i.others}"${i.inputs})`},scope:"line",reverse:{pattern:zn(),replacement:(e,...t)=>{let n=$n(e,...t);return"%R"+n.input+n.output+n.other+n.contents},scope:"line"}},{pattern:"^%%R"+Fn(10)+"(\n)?([\\s\\S]*)",replacement:(e,...t)=>{let n=On(t,-3);return`${n.outputs}rpy2.ipython.rmagic.RMagics.R("""${n.content}""", "${n.others}"${n.inputs})`},scope:"cell",reverse:{pattern:zn('"""',!0),replacement:(e,...t)=>{let n=$n(e,...t);return"%%R"+n.input+n.output+n.other+"\n"+n.contents},scope:"cell"}},{pattern:In+"%Rdevice( .*)?(\n|$)",replacement:(e,t,...n)=>`${t}rpy2.ipython.rmagic.RMagics.Rdevice("${n[0]}", "")`,scope:"line",reverse:{pattern:zn('"',!1,"Rdevice"),replacement:(e,...t)=>{let n=$n(e,...t);return"%Rdevice"+n.input+n.output+n.other+n.contents},scope:"line"}}];const Vn={id:o+":ipython-rpy2",requires:[c,f],activate:(e,t,n)=>{for(let e of Object.keys(Nn))for(let n of Nn[e])t.register(n,e);for(let e of Un)n.register(e,"python")},autoStart:!0},Bn="(?:"+["-l","--connections"].join("|")+"|"+["-x","--close","-c","--creator","-p","--persist","--append"].map((e=>e+" \\w+")).join("|")+")";let Kn={python:[new m({language:"sql",pattern:`^%%sql(?: (?:(?:(?:.*?)://(?:.*))|${Bn}|(?:\\w+ << )|(?:\\w+@\\w+)))?\n?((?:.+\n)?(?:[^]*))`,foreign_capture_groups:[1],is_standalone:!0,file_extension:"sql"}),new m({language:"sql",pattern:`(?:^|\n)%sql (?:(?:(?:.*?)://(?:.*))|${Bn}|(.*))\n?`,foreign_capture_groups:[1],is_standalone:!1,file_extension:"sql"})]};const Zn=[Vn,{id:o+":ipython-sql",requires:[c],activate:(e,t)=>{for(let e of Object.keys(Kn))for(let n of Kn[e])t.register(n,e)},autoStart:!0},Pn,Ln];class Jn{constructor(e,t){this.virtual_editor=e,this.adapter=t}markText(e,t,n){let i=this.virtual_editor.virtual_document.get_editor_at_source_line(e),s=this.virtual_editor.ce_editor_to_cm_editor.get(i),o=this.virtual_editor;return s.getDoc().markText(o.transform_from_root_to_editor(e),o.transform_from_root_to_editor(t),n)}getCursor(e){let t=this.adapter.activeEditor;if(null==t)return;let n=t.editor.getDoc().getCursor(e);return this.virtual_editor.transform_from_editor_to_root(t,n)}}class Gn{constructor(e){return this.editor_name="CodeMirrorEditor",this.isDisposed=!1,this._event_wrappers=new Map,this.adapter=e.adapter,this.virtual_document=e.virtual_document,this.console=this.adapter.console,this.change=new j.Signal(this),this.block_added_handlers=[],this.block_removed_handlers=[],this.editor_to_source_line=new Map,this.cm_editor_to_ce_editor=new Map,this.ce_editor_to_cm_editor=new Map,this._proxy=new Proxy(this,{get:function(e,t,n){return t in e?Reflect.get(e,t,n):void console.warn(`Unimplemented method ${t.toString()} for CodeMirrorVirtualEditor`)}}),this.virtual_document.update_manager.update_began.connect(this.onEditorsUpdated,this),this.virtual_document.update_manager.block_added.connect(this.save_block_position,this),this.virtual_document.update_manager.update_finished.connect((()=>{this.editor_to_source_line=this.editor_to_source_line_new}),this),this.set_event_handlers(),this._proxy}dispose(){if(!this.isDisposed){this.editor_to_source_line.clear(),this.cm_editor_to_ce_editor.clear(),this.ce_editor_to_cm_editor.clear(),this.off("change",this.emit_change);for(let[[e],t]of this._event_wrappers.entries())this.forEveryBlockEditor((n=>{n.off(e,t)}),!1);this._event_wrappers.clear(),this.disconnectBlockMonitoring(),this.virtual_document.dispose(),this.virtual_document=null,this.code_extractors=null,this.isDisposed=!0,this.forEveryBlockEditor=null,this._proxy=null}}get_cursor_position(){return this.getDoc().getCursor("end")}onEditorsUpdated(e,t){this.cm_editor_to_ce_editor.clear(),this.ce_editor_to_cm_editor.clear(),this.editor_to_source_line_new=new Map;for(let e of t){let t=e.ce_editor,n=t.editor;this.cm_editor_to_ce_editor.set(n,t),this.ce_editor_to_cm_editor.set(t,n)}}save_block_position(e,t){this.editor_to_source_line_new.set(t.block.ce_editor,t.virtual_document.last_source_line)}set_event_handlers(){this.on("change",this.emit_change.bind(this))}emit_change(e,t){this.change.emit(t)}window_coords_to_root_position(e){const t=this.coordsChar(e,"window");return-1===t.line&&-1===t.ch?null:t}get_token_at(e){let t=this.getTokenAt(e);return{value:t.string,offset:t.start,type:t.type||""}}get_cm_editor(e){return this.get_editor_at_root_line(e)}transform_virtual_to_editor(e){return this.virtual_document.transform_virtual_to_editor(e)}document_at_root_position(e){let t=e;return this.virtual_document.root.document_at_source_position(t)}root_position_to_virtual_position(e){let t=e;return this.virtual_document.root.virtual_position_at_document(t)}get_editor_at_root_position(e){return this.virtual_document.root.get_editor_at_source_line(e)}root_position_to_editor(e){return this.virtual_document.root.transform_source_to_editor(e)}on(e,t,...n){let i=(e,...n)=>{try{return t(this,...n)}catch(t){this.console.warn("CodeMirrorVirtualEditor handler (which should accept a CodeMirror Editor instance) failed",{error:t,instance:e,args:n,this:this})}};this._event_wrappers.set([e,t],i),this.forEveryBlockEditor((t=>{t.on(e,i)}),!0,(t=>{t.off(e,i)}))}off(e,t,...n){let i=this._event_wrappers.get([e,t]);this.forEveryBlockEditor((t=>{t.off(e,i)}))}find_ce_editor(e){return this.cm_editor_to_ce_editor.get(e)}transform_from_editor_to_root(e,t){if(!this.editor_to_source_line.has(e))return this.console.warn("Editor not found in editor_to_source_line map"),null;let n=this.editor_to_source_line.get(e);return Object.assign(Object.assign({},t),{line:t.line+n})}transform_from_root_to_editor(e){return this.virtual_document.transform_source_to_editor(e)}addKeyMap(e,t){}addLineClass(e,t,n){}addLineWidget(e,t,n){}addOverlay(e,t){for(let n of this.adapter.editors)n.editor.addOverlay(e,t)}addPanel(e,t){}charCoords(e,t){try{return this.get_editor_at_root_line(e).charCoords(e,t)}catch(e){return console.log(e),{bottom:0,left:0,right:0,top:0}}}coordsChar(e,t){let n=null;for(let i of this.adapter.editors){let s=i.editor.coordsChar(e,t);if(1!==s.outside){n=this.transform_from_editor_to_root(i,s);break}}return null==n?{line:-1,ch:-1}:n}cursorCoords(e,t){return"boolean"!=typeof e&&null!=e?this.get_editor_at_root_line(e).cursorCoords(this.transform_from_root_to_editor(e)):{bottom:0,left:0,top:0}}get any_editor(){return this.adapter.editors[0].editor}defaultCharWidth(){return this.any_editor.defaultCharWidth()}defaultTextHeight(){return this.any_editor.defaultTextHeight()}endOperation(){for(let e of this.adapter.editors)e.editor.endOperation()}execCommand(e){for(let t of this.adapter.editors)t.editor.execCommand(e)}getDoc(){return new Jn(this,this.adapter)}get_editor_at_root_line(e){let t=this.virtual_document.root.get_editor_at_source_line(e);return this.ce_editor_to_cm_editor.get(t)}getTokenAt(e,t){return this.get_editor_at_root_line(e).getTokenAt(this.transform_from_root_to_editor(e))}getTokenTypeAt(e){let t=this.virtual_document.get_editor_at_source_line(e);return this.ce_editor_to_cm_editor.get(t).getTokenTypeAt(this.transform_from_root_to_editor(e))}get_editor_value(e){return e.model.value.text}getWrapperElement(){return this.adapter.wrapper_element}heightAtLine(e,t,n){return 0}isReadOnly(){return!1}lineAtHeight(e,t){return 0}disconnectBlockMonitoring(){for(let e of this.block_added_handlers)this.adapter.editorAdded.disconnect(e);this.block_added_handlers=[];for(let e of this.block_removed_handlers)this.adapter.editorRemoved.disconnect(e);this.block_removed_handlers=[]}forEveryBlockEditor(e,t=!0,n=null){const i=new Set;for(let t of this.adapter.editors){let n=t.editor;i.add(n),e(n)}if(t){const t=(t,n)=>{let{editor:s}=n;if(null==s)return;let o=s.editor;i.has(o)||e(o)},s=(e,t)=>{if(null==n)return;let{editor:i}=t;if(null==i)return;let s=i.editor;n(s)};this.block_added_handlers.push(t),this.block_added_handlers.push(s),this.adapter.editorAdded.connect(t),this.adapter.editorRemoved.connect(s)}}find_editor(e){let t=this.cm_editor_to_ce_editor.get(e);return{index:this.adapter.get_editor_index(t),node:this.adapter.get_editor_wrapper(t)}}}const Xn={id:o+":CodeMirrorVirtualEditor",requires:[l],activate:(e,t)=>t.registerEditorType({implementation:Gn,name:"CodeMirrorEditor",supports:gt.CodeMirrorEditor}),autoStart:!0};class Yn{constructor(){this.editorTypes=[]}registerEditorType(e){this.editorTypes.push(e)}findBestImplementation(e){for(let t of this.editorTypes)if(e.every((e=>e instanceof t.supports)))return t;return console.warn("Cold not find a VirtualEditor suitable for the provided set of editors:",e),null}}const Qn={id:o+":ILSPVirtualEditorManager",requires:[],activate:e=>new Yn,provides:l,autoStart:!0};var ei=v.JupyterFrontEnd.IPaths;class ti{constructor(){this.features=[],this.command_managers=[],this.command_manager_registered=new j.Signal(this)}_register(e){if(e.supersedes)for(let t of e.supersedes)this.features=this.features.filter((e=>e.id!=t));if(this.features.push(e.feature),e.feature.commands){for(let t of this.command_managers)t.add(e.feature.commands);this.command_manager_registered.connect(((t,n)=>{e.feature.commands&&n.add(e.feature.commands)}))}}register(e){e.feature.settings&&e.feature.settings.ready?e.feature.settings.ready.then((()=>{var t,n;(null===(n=null===(t=e.feature)||void 0===t?void 0:t.settings)||void 0===n?void 0:n.composite.disable)?console.log("Skipping ",e.feature.id,"as disabled"):this._register(e)})).catch(console.warn):this._register(e)}registerCommandManager(e){this.command_managers.push(e),this.command_manager_registered.emit(e)}}class ni{constructor(e,t,n,i,s,r,a,l,c,d,h,u,_){this.app=e,this.setting_registry=t,this.palette=n,this.editor_type_manager=a,this.code_extractors_manager=l,this.code_overrides_manager=c,this.console=d,this.translator=h,this.user_console=u;const g=(h||C.nullTranslator).load("jupyterlab_lsp");this.language_server_manager=new kn({console:this.console.scope("LanguageServerManager")}),this.connection_manager=new F({language_server_manager:this.language_server_manager,console:this.console.scope("DocumentConnectionManager")});const p=new Re({language_server_manager:this.language_server_manager,connection_manager:this.connection_manager,adapter_manager:r,translator_bundle:g});null!==_?_.registerStatusItem(o+":language-server-status",{item:p.createItem(),align:"left",rank:1,isActive:()=>r.isAnyActive()}):e.docRegistry.addWidgetExtension("Notebook",p),this.feature_manager=new ti,this.setting_registry.load(ii.id).then((e=>{const t=e.composite,n=t.language_servers||{};this.connection_manager.initial_configurations=n,this.connection_manager.updateConfiguration(n),this.connection_manager.updateLogging(t.logAllCommunication,t.setTrace),e.changed.connect((()=>{this.updateOptions(e)}))})).catch((e=>{d.error(e.message)})),r.registerExtension(this)}registerAdapterType(e,t){let n=new ue(Object.assign({adapter_manager:e,app:this.app,palette:this.palette,tracker:t.tracker,suffix:t.name,entry_point:t.entrypoint,console:this.console},t.context_menu));this.feature_manager.registerCommandManager(n)}get foreign_code_extractors(){return this.code_extractors_manager.registry}get code_overrides(){return this.code_overrides_manager.registry}updateOptions(e){const t=e.composite,n=t.language_servers||{};this.connection_manager.initial_configurations=n,this.connection_manager.updateConfiguration(n),this.connection_manager.updateServerConfigurations(n),this.connection_manager.updateLogging(t.logAllCommunication,t.setTrace)}}const ii={id:o+":plugin",requires:[x.ISettingRegistry,w.ICommandPalette,y.IDocumentManager,ei,a,l,c,f,d,C.ITranslator],optional:[b.ILoggerRegistry,k.IStatusBar],activate:(e,...t)=>new ni(e,...t).feature_manager,provides:r,autoStart:!0},si=[Ct,ut,mn,on,dn,Jt,Wt,bn],oi=[Z,ze,D,he,le,Qn,Xn,S.COMPLETION_THEME_MANAGER,E.plugin,M.plugin,Sn,ii,...Zn,...si]},6988:(e,t,n)=>{n.d(t,{_v:()=>a,EU:()=>l,nE:()=>c,Gl:()=>d,Ei:()=>h,lj:()=>g,HY:()=>m,ry:()=>f});var i=n(2451),s=n(8644),o=n.n(s);const r=/^file:\/\/([^\/]+|\/[a-zA-Z](?::|%3A))/;async function a(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}function l(e,t=35,n=50,i=(e=>e)){return new Promise((async(s,o)=>{let r=0;for(;!0!==e();){if(r+=1,-1!==t&&r>t){o("Too many retrials");break}n=i(n),await a(n)}s(e)}))}function c(e,t){const n=e.key||null;let i=!1;switch(t){case"Shift":i=e.shiftKey||"Shift"==n;break;case"Alt":i=e.altKey||"Alt"==n;break;case"AltGraph":i="AltGraph"==n;break;case"Control":i=e.ctrlKey||"Control"==n;break;case"Meta":i=e.metaKey||"Meta"==n;break;case"Accel":i=e.metaKey||"Meta"==n||e.ctrlKey||"Control"==n}return void 0!==e.getModifierState?i||e.getModifierState(t):i}class d extends Map{constructor(e,t){super(t),this.default_factory=e}get(e){return this.get_or_create(e)}get_or_create(e,...t){if(this.has(e))return super.get(e);{let n=this.default_factory(e,...t);return this.set(e,n),n}}}function h(e,t){return u(e)&&u(t)&&(e=_(e),t=_(t)),e===t||decodeURI(e)===decodeURI(t)}function u(e){return e.match(r)}function _(e){return e.replace(r,(e=>e.replace("%3A",":").toLowerCase()))}function g(e,t){return null==(t=t||i.PageConfig.getOption("rootUri"))?null:e.startsWith(t)?decodeURI(e.replace(t,"")):null}const p=(e,t)=>{const n={};let i=n;return e.forEach(((n,s)=>{i[n]={},s===e.length-1?i[n]=t:i=i[n]})),n},m=e=>{const t=[];for(let n in e){const i=p(n.split("."),e[n]);t.push(i)}return o()({},...t)};function f(e){e=e.replace(/([\\#*_[\]])/g,"\\$1");const t=document.createElement("span");return t.textContent=e,t.innerHTML.replace(/\n/g,"<br>").replace(/ {2}/g,"  ")}}}]);